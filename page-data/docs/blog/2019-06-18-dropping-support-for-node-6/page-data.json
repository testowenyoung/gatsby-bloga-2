{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2019-06-18-dropping-support-for-node-6/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"21ab305c-588c-5b9f-b6a7-2c2d80da7314","excerpt":"Effective in Gatsby v2.10.0, we are making a potentially breaking change and dropping support for Node 6. We don’t take this decision lightly, and realize that…","html":"<p>Effective in Gatsby v2.10.0, we are making a potentially breaking change and dropping support for Node 6. We don’t take this decision lightly, and realize that there is <em>potential</em> for breaking applications by not following <a href=\"https://semver.org/\">semantic versioning</a> <em>strictly</em> and releasing a new major version of Gatsby (v3.0.0).</p>\n<p>We are making this decision because Node 6 was transitioned into end-of-life status on April 30th, 2019. As such, we’re reluctantly dropping support as more and more of Gatsby’s dependencies also drop support for Node 6. Making this explicit change and dropping support allows the Gatsby team to focus more efficiently on delivering fixes and features that directly improve the quality of Gatsby for <em>all</em> users.</p>\n<p>Interested in learning more about the <em>why</em> of why we’re making this change? Great! Read on below.</p>\n<h2>Why</h2>\n<p>Several months ago (01/03/2019) we opened a <a href=\"https://github.com/gatsbyjs/rfcs/pull/24\">Request for Commentary (RFC)</a>, outlining our strategy for dropping Node 6 and making this breaking change. We began by making documentation changes to gently guide Gatsby users towards making the change to Node 8 or greater. We did this in several ways, specifically:</p>\n<ol>\n<li>\n<p>Used <code class=\"language-text\">async</code>, <code class=\"language-text\">await</code>, and other non-supported features in Node 6 in our documentation</p>\n<ul>\n<li>Copying code directly from the docs will manifest a runtime error in Node 6, and will gently guide towards updating to Node 8 or greater</li>\n</ul>\n</li>\n<li><a href=\"/gatsby-bloga-2/tutorial/part-zero/#install-nodejs-for-your-appropriate-operating-system\">Documented that our minimum supported version is Node 8 or greater</a></li>\n</ol>\n<p>These approaches jointly served as a gentle guide towards encouraging users to upgrade to Node 8 <em>prior to this breaking change.</em> However, up to this point, I haven’t defended why we’re making the breaking change. Let me do just that.</p>\n<h2>Why a Breaking Change?</h2>\n<p>We don’t take lightly the potential for breaking changes. Our ultimate goal in publishing versions of Gatsby and plugins is that we <em>never</em> want to make a breaking change without a major version bump. In fact, our approach is to publish early and often so that we can get new features and fixes in user’s hands as soon as possible. Our intent is that users will update their Gatsby dependencies regularly and often to get these new features and fixes as quickly as possible. This model crucially depends upon trust in being able to upgrade these dependencies as often as we ship them.</p>\n<p>However, we have regularly and repeatedly found it extremely challenging to keep delivering these valuable features and fixes while still maintaining support for Node 6. Many of our dependencies (and further still, dependencies of our dependencies) have dropped support for Node 6 in newer releases, thereby preventing Gatsby from updating these dependencies to get needed features and fixes.</p>\n<p>Further still continuing to support Node 6 is making it more challenging to publish early and often. Pull requests, particularly those implemented by the Gatsby Core team, need extra time to ensure we have the necessary checks and workarounds to maintain Node 6 support. As an example, consider the excellent PR to <a href=\"https://github.com/gatsbyjs/gatsby/pull/13089\">rework our CLI to use Ink</a>. We had to introduce a <a href=\"https://github.com/gatsbyjs/gatsby/pull/13089/files/3a61ec690eebc814084432cbd3645765f4dfa109#diff-ff3f290e45718ddc8e9f3d6bdb59e7f5\">separate entry point</a> for versions of Node prior to Node 8 because our dependency Ink does not support Node 6.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> semver <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">semver</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> isCI <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">ci-info</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>semver<span class=\"token punctuation\">.</span><span class=\"token function\">satisfies</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">>=8</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>isCI<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./ink</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>default\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n  module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./yurnalist</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Consider <a href=\"https://github.com/gatsbyjs/gatsby/pull/13913/files\">another recent PR</a> where a dependency didn’t support Node 6, so we were forced to introduce a mechanism to skip the tests in Node 6 to pass our Continuous Integration (CI) test suite. How very <a href=\"https://github.com/auchenberg/volkswagen\"><em>Volkswagen</em></a> of us 😈</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">testInNode8OrHigher</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">title<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> isNode8OrHigher <span class=\"token operator\">=</span> semver<span class=\"token punctuation\">.</span><span class=\"token function\">satisfies</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>version<span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">>=8</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isNode8OrHigher<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">it</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    it<span class=\"token punctuation\">.</span><span class=\"token function\">skip</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">skipped on Node 7 or lower: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This much is clear. Supporting Node 6 is making it <strong>more challenging to ship features and fixes</strong> in a timely fashion. Why make this <em>potential</em> breaking change in a minor release? Glad you asked.</p>\n<h3>Breaking in a Minor Release — Oh, the Humanity!</h3>\n<p>There are minimally two types of breaking changes:</p>\n<ol>\n<li><strong>Known breaking changes</strong>: breaking changes that change how something is consumed, e.g. changing the name of an API method. These should <em>only</em> happen in major versions.</li>\n<li><strong>Potential breaking changes</strong>: this <em>could</em> be a breaking change, but we’re not <em>sure</em>, and we need data to know whether this could be a known breaking change.</li>\n</ol>\n<p>Known breaking changes should never happen in a non-major release. However, potential breaking changes are more reasonable to do in a minor release <em>if</em> we can quantify the number of users that are using Node 6 and most importantly, the number of users using later versions of Gatsby that would contain this breaking change.</p>\n<p>Happy to report that we have this very data which helps us make an informed decision here and judge that this is merely a potential breaking change. This change has the <em>potential</em> to impact an extremely small percentage of Gatsby users. Specifically, less than 1% of Gatsby users are using Node 6, and fewer still from that group are using Gatsby 2.0.0 or newer. Pictures are worth lots of words, so let’s take a look at a chart <em>showing</em> this data.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/3c0e2f870377b82d39b258ad7f572ca0/a6d66/node-6-usage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABU0lEQVQY01VRz0sCQRTevziwLuIhoU6eOllQdiiCNIhKi5BMCrHS6BCCKSGoEKXZ7I677szOzuzXzJqEM7wfvB/f9+aNpVSEKPoXpcUcnzHYtg2HUhBt6XSqfQeEEARCxDWLHix6lYJlVCwxmEL0d01MhiEiqWJRoQLCCFJIRGpObGpMLdcExKEQ2lpBEGDpKEM9Z+cyxMSfYiIoeu4HGqO2TguNu9zDONOAduxbQgP27TGGzghX70846d6DcBe1zxZynWtkXvNYfzhG+uYSq6clpG7PUey1UR/00fwa4nk8AGUzfNtkDmhU/q2CjcYhko+7SNSzeBl3cdApI9XcQ7JSwNpRBSv7d0jnqtjKnqFY2ka1uIlyIYOLnQR6rRpc6sZrsKSUYPoDXM3C9bS+Hp9xHtsZ9+F5DD8TO84JHQfzEfn6eZxAeXoqz0FAJxDMNZvCL4iPvFmYNfKcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Percentage of Node 6 users vs. Gatsby versions\"\n        title=\"Percentage of Node 6 users vs. Gatsby versions\"\n        src=\"/gatsby-bloga-2/static/3c0e2f870377b82d39b258ad7f572ca0/fcda8/node-6-usage.png\"\n        srcset=\"/gatsby-bloga-2/static/3c0e2f870377b82d39b258ad7f572ca0/12f09/node-6-usage.png 148w,\n/gatsby-bloga-2/static/3c0e2f870377b82d39b258ad7f572ca0/e4a3f/node-6-usage.png 295w,\n/gatsby-bloga-2/static/3c0e2f870377b82d39b258ad7f572ca0/fcda8/node-6-usage.png 590w,\n/gatsby-bloga-2/static/3c0e2f870377b82d39b258ad7f572ca0/efc66/node-6-usage.png 885w,\n/gatsby-bloga-2/static/3c0e2f870377b82d39b258ad7f572ca0/c83ae/node-6-usage.png 1180w,\n/gatsby-bloga-2/static/3c0e2f870377b82d39b258ad7f572ca0/a6d66/node-6-usage.png 2070w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Relying upon this data, we feel confident that while this is a theoretical breaking change it will impact a very small percentage of real-world users and use-cases. If you are impacted by this breaking change, we have put together a <a href=\"https://gatsby.dev/upgrading-node-js\">handy upgrade guide</a>. Upgrading from Node 6 is inherently valuable <em>outside</em> of a Gatsby context as it has reached its <a href=\"https://nodejs.org/en/about/releases/\">“End of Life (EOL)”</a> from the Node foundation and will no longer receive critical security fixes and bug fixes.</p>\n<p>Finally, if you’re interested, I’ll now go into some technical detail as to <em>how</em> we’re actually making this breaking change.</p>\n<h2>Technical Detail of the Breaking Change</h2>\n<p>The technical details of this change are actually quite simple. All of our packages rely upon a shared <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/babel-preset-gatsby-package\">Babel preset (<code class=\"language-text\">babel-preset-gatsby-package</code>)</a>. Upon a publish, we use <a href=\"https://babeljs.io/docs/en/babel-preset-env#targetsnode\"><code class=\"language-text\">@babel/preset-env</code></a> to transpile our packages for our minimum Node.js supported version, which was previously <code class=\"language-text\">6.0</code>. In the <a href=\"https://github.com/gatsbyjs/gatsby/pull/14842\">PR introducing this breaking change</a>, we change the <code class=\"language-text\">target</code> to <code class=\"language-text\">8.0</code> which will transpile our packages to Node.js syntax supported in Node 8 and newer.</p>\n<p>This allows us to transpile less code (e.g. <code class=\"language-text\">async</code> and <code class=\"language-text\">await</code> are natively supported in Node 8) and constitutes the <em>actual</em> breaking change. Any package(s) released with this new preset will no longer work in Node 6. The breaking change is advantageous here because it is clear and deliberate, and we can now safely support Node 8 and above, which allows us to ship features more quickly.</p>\n<p>To best support any users who may still be using Node 6 and these newer versions of Gatsby packages, we do log an error from the command line interface (CLI):</p>\n<blockquote>\n<p>Gatsby requires Node.js v8 or higher (you have “6.0.0”).\nUpgrade Node to the latest stable release: <a href=\"https://gatsby.dev/upgrading-node-js\">https://gatsby.dev/upgrading-node-js</a></p>\n</blockquote>\n<p>We are very much cognizant that this change may introduce some measure of churn and potential confusion for that very small percentage of users who may still be on Node 6 and using recent versions of Gatsby packages. However, in an effort to increase productivity and deliver features and fixes to the great <strong>majority</strong> of users not using Node 6, we feel confident that it’s time to make this change.</p>","frontmatter":{"title":"Dropping Support for Node 6","date":"June 18, 2019","description":null}}},"pageContext":{"slug":"/docs/blog/2019-06-18-dropping-support-for-node-6/","previous":{"fields":{"slug":"/docs/blog/2019-06-17-day-in-the-life-of-a-core-maintainer/"},"frontmatter":{"title":"A Day in the Life of a Core Maintainer"}},"next":{"fields":{"slug":"/docs/blog/2019-06-19-open-beta-for-gatsby-preview-is-here/"},"frontmatter":{"title":"Open Beta for Gatsby Preview is here!"}}}}}