{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2020-05-21-gatsby-recipes/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"0c18cf30-6c55-5e8a-b99d-7924bcb3afa4","excerpt":"Gatsby Recipes were introduced just last month, as a new tool to automate common site building tasks. A Gatsby Recipe is a kind of task runner that can be‚Ä¶","html":"<p>Gatsby Recipes were introduced just last month, as a new tool to automate common site building tasks. A Gatsby Recipe is a kind of task runner that can be authored in MDX and then executed from the command line using the Gatsby CLI.</p>\n<p>Recipes can be used to automate npm installs, run npm scripts, add config options to <code class=\"language-text\">gatsby-config.js</code> and create files. A Recipe is a stepped list of tasks described in a human readable list which can be locally saved or remotely hosted, and the really good ones can be submitted via PR to be included in the Gatsby CLI.</p>\n<p>Gatsby ships with a number of default Recipes, but it‚Äôs also really easy to create your own! In this post we are going to look at writing a Recipe to install <code class=\"language-text\">gatsby-plugin-google-analytics</code> and add it to your project‚Äôs plugins. But first let‚Äôs take a look at why Recipes are so very useful and how I got started with doing some for tasks I found particularly taxing.</p>\n<p>(You can read more about <a href=\"/gatsby-bloga-2/blog/2020-04-15-announcing-gatsby-recipes/\">Recipes</a>, the experimental <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-recipes/README.md\">README</a> and, to track the conversation, <a href=\"https://github.com/gatsbyjs/gatsby/issues/22991\">the Umbrella Issue on GitHub</a>).</p>\n<h2>Recipes: What‚Äôs all the fuss about?</h2>\n<p>I‚Äôm a React UI Developer and I work on a lot of Greenfield Component Library builds. One of the tasks I find myself doing more often than I‚Äôd like is the install and config for Storybook. This in itself isn‚Äôt a massive job, but getting Storybook and Gatsby to play nicely together can be a little tricky. Making this tricky bit happen more easily seemed like the perfect opportunity for creating a Recipe.</p>\n<p>(I should point out that neither Storybook or Gatsby are at fault here. They are both rock solid projects but, as you can imagine, they were never intended to be <em>out of the box</em> compatible).</p>\n<p>To get the two playing nicely together it requires a little under the hood knowledge about Gatsby and Storybook, and this knowledge supplies the foundation for writing a Recipe to handle it:</p>\n<ul>\n<li>Gatsby is written in ES6 and isn‚Äôt transpiled to CommonJS until either the <code class=\"language-text\">gatsby develop</code> or <code class=\"language-text\">gatsby build</code> processes are run.</li>\n<li>Storybook requires all module code to be transpiled to CommonJS.</li>\n</ul>\n<p>The problem here is when you run Storybook it has no knowledge of the Gatsby build processes and will only transpile ‚Äúyour‚Äù ES6 code to CommonJS. This is mostly fine apart from when you attempt to create a story for a Gatsby component, or a story that embeds or composes a Gatsby component. One such component is <code class=\"language-text\">&lt;Link /&gt;</code></p>\n<p>For example:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> ‚Äògatsby‚Äô</code></pre></div>\n<p>The reason this will cause Storybook to error is because the <code class=\"language-text\">&lt;Link /&gt;</code> component comes from Gatsby / <code class=\"language-text\">node_modules</code> which, as mentioned above, is (as yet) un-transpiled ES6 code.</p>\n<p>Storybook has anticipated this issue, fortunately, and so there is a method whereby you can write your own webpack config and pass it on to combine it with the default Storybook webpack config. This then aids in the transpiling of any ES6 code located in <code class=\"language-text\">node_modules</code> to CommonJS.</p>\n<p>If (like me) Webpack scares you a little bit, you‚Äôll likely want to avoid writing any Webpack config and just get on with developing your UI. You could try not creating any <code class=\"language-text\">.stories</code> that include a <code class=\"language-text\">&lt;Link /&gt;</code> component but this will only get you so far.</p>\n<p>You may at some point also wish to create a story for a component that contains a <code class=\"language-text\">useStaticQuery</code> hook, and if you do that you‚Äôll again see Storybook errors but this time relating to GraphQL queries. The reason for this is because the Gatsby build processes remove any GraphQL queries when you run either of the build processes; <code class=\"language-text\">gatsby develop</code> or <code class=\"language-text\">gatsby build</code>.</p>\n<p>So, as mentioned before, when you spin up Storybook these Gatsby-specific build processes are simply not run. In order to to strip out GraphQL queries we need to use Webpack again and utilize a package called <code class=\"language-text\">babel-plugin-remove-graphql-queries</code>.</p>\n<p>And if (like me) Babel also scares you a little bit, you might be having a think about giving up using Storybook and Gatsby all together.</p>\n<p><strong>But don‚Äôt quit just yet!</strong></p>\n<h2>Recipes to the rescue</h2>\n<p>It‚Äôs for precisely this reason I created two of my own Recipes to automate the setup of Storybook and its webpack config for both JavaScript and TypeScript Gatsby projects.</p>\n<p>If you haven‚Äôt installed the latest Gatsby CLI run this üëá</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g gatsby-cli@latest</code></pre></div>\n<p>Now you can now run üëá</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gatsby recipes</code></pre></div>\n<p>You should see from the list there are two options for Storybook.</p>\n<ul>\n<li><strong>Add Storybook - JavaScript</strong></li>\n<li><strong>Add Storybook - TypeScript</strong></li>\n</ul>\n<p>These are both largely the same with only some small differences to manage <code class=\"language-text\">.ts|tsx</code> as well as <code class=\"language-text\">.js|jsx</code> files and a little difference in the way they process props which populate the Storybook prop table.</p>\n<p>If you‚Äôve got this far I‚Äôm sure you‚Äôll agree that running a simple CLI command to install and configure Storybook is way easier than manually configuring it yourself and it‚Äôs why I believe we should all be making more fuss about Recipes‚Ä¶ they‚Äôre absolutely super brill brills!</p>\n<p>If you‚Äôre interested, here is where you can read more about my Recipesüëá</p>\n<ul>\n<li><a href=\"https://paulie.dev/posts/2020/04/gatsby-recipe-storybook-js/\">Storybook - Js</a></li>\n<li><a href=\"https://paulie.dev/posts/2020/05/gatsby-recipe-storybook-ts/\">Storybook - Ts</a></li>\n</ul>\n<h2>Fancy writing your own Recipe?</h2>\n<p>The Recipe we‚Äôre going to write will install <code class=\"language-text\">gatsby-plugin-google-analytics</code> and add it to the plugins array in <code class=\"language-text\">gatsby-config.js</code>.</p>\n<p>This recipe will utilize two of the Recipe components/providers. The first is <code class=\"language-text\">&lt;NPMPackage /&gt;</code> the second is <code class=\"language-text\">&lt;GatsbyPlugin /&gt;</code></p>\n<p>You can read more about the components/providers in the <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby-recipes/README.md#developing-recipes\">Gatsby Recipes README</a>.</p>\n<p>To get things started you can clone this bare bones repo which has just the bits we need to create and test your very first Recipe:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">git</span> clone https://github.com/PaulieScanlon/gatsby-recipe-google-analytics.git</code></pre></div>\n<p>Or clone from the repo here: <a href=\"https://github.com/PaulieScanlon/gatsby-recipe-google-analytics\">https://github.com/PaulieScanlon/gatsby-recipe-google-analytics</a></p>\n<p>Once you have the repo cloned locally, create a new file at the root of the project and call it <code class=\"language-text\">gatsby-recipe-ga.mdx</code> and add the following MDX</p>\n<div class=\"gatsby-highlight\" data-language=\"mdx:title=gatsby-recipe-ga.mdx\"><pre class=\"language-mdx:title=gatsby-recipe-ga.mdx\"><code class=\"language-mdx:title=gatsby-recipe-ga.mdx\"># Add `gatsby-plugin-google-analytics` to Gatsby Project\n\nMore info about the plugin can be found here: üëâ [gatsby-plugin-google-analytics](/packages/gatsby-plugin-google-analytics/)\n\n---\n\nInstall `gatsby-plugin-google-analytics`\n\n&lt;NPMPackage name=&quot;gatsby-plugin-google-analytics&quot; /&gt;\n\n---\n\nAdd the Google Analytics plugin to gatsby-config.js\n\n&lt;GatsbyPlugin\n  name=&quot;gatsby-plugin-google-analytics&quot;\n  options={{\n    trackingId: &quot;YOUR GOOGLE ANALYTICS TRACKING ID&quot;,\n    head: false,\n    anonymize: true,\n    respectDNT: true,\n    exclude: [&quot;/preview/**&quot;, &quot;/do-not-track/me/too/&quot;],\n    pageTransitionDelay: 0,\n    optimizeId: &quot;YOUR GOOGLE OPTIMIZE TRACKING ID&quot;,\n    experimentId: &quot;YOUR GOOGLE EXPERIMENT ID&quot;,\n    variationId: &quot;YOUR GOOGLE OPTIMIZE VARIATION ID&quot;,\n    defer: false,\n    sampleRate: 5,\n    siteSpeedSampleRate: 10,\n    cookieDomain: &quot;example.com&quot;,\n  }}\n/&gt;\n\n---\n\nAll done: üçª\n\nHead over to `gatsby-config.js` to complete the setup by amending or removing the plugin options. You will need a Google Analytics `trackingId`\n\nYou can read more about how to use the plugin here: üëâ [How to use](/packages/gatsby-plugin-google-analytics/#how-to-use)</code></pre></div>\n<h2>Running your first Recipe</h2>\n<p>Now that you‚Äôve written your first Recipe, it‚Äôs time to run it! üëá</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gatsby recipes ./gatsby-recipe-ga.mdx</code></pre></div>\n<p>You should see the CLI start up. It‚Äôll look to the root of your project and run your new Recipe. You‚Äôll be prompted at each step to confirm the install ‚Äî hitting <em>Enter</em> will do the trick here.</p>\n<p>If all has gone to plan, the plugin will have been installed from <code class=\"language-text\">npm</code> and <code class=\"language-text\">gatsby-config.js</code> will have been updated with all the required options for the plugin to work.</p>\n<h2>Automating the automation</h2>\n<p>You can probably see now how Recipes can be used to automate otherwise quite manual singular tasks, and this is great! But ask yourself: wouldn‚Äôt it be even greater if Recipes didn‚Äôt just run a task once?</p>\n<p>Imagine if Recipes could be used over and over again to automate really monotonous tasks!</p>\n<p>One such task might be creating new components. On any typical project this would be my component setup preference.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">‚îú‚îÄ ComponentName\n    ‚îî‚îÄ index.ts\n    ‚îî‚îÄ ComponentName.tsx\n    ‚îî‚îÄ ComponentName.stories.tsx\n    ‚îî‚îÄ ComponentName.test.tsx</code></pre></div>\n<p>Of course within each of those files are a number of imports, exports, interfaces, function declarations and tests. Doing this each and every time you create a new component is tedious and can sometimes be prone to human error.</p>\n<p>Also, and especially on larger teams, these preferences for how files should be named ‚Äî and/or how the imports, exports and declarations should be written is rarely documented in a ‚Äústyle guide‚Äù because that alone is also a rather tiresome task! But in my experience it‚Äôs something that‚Äôs rather crucial to have ‚Äúlocked down‚Äù at the start of a project.</p>\n<p>In early 2018 I attempted to solve this problem by creating a node module aimed at automating the React ‚Äúcomponent‚Äù creation process, <a href=\"https://www.npmjs.com/package/node-tiny-template\">node-tiny-template</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/d93f8474c6eb516d18fe8564185495e5/eec88/node-tiny-template.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdyyQD//xAAVEAEBAAAAAAAAAAAAAAAAAAAgQf/aAAgBAQABBQKn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGhAAAgIDAAAAAAAAAAAAAAAAAREAEDFBcf/aAAgBAQABPyENt8FjMVf/2gAMAwEAAgADAAAAEEPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRABAQEBAQEAAAAAAAAAAAAAAREAITFx/9oACAEBAAE/EJqqLwhN2eJ9ceYdZqVxw3//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"landing page for the Node Tiny Template\"\n        title=\"Node Tiny Template\"\n        src=\"/gatsby-bloga-2/static/d93f8474c6eb516d18fe8564185495e5/1c72d/node-tiny-template.jpg\"\n        srcset=\"/gatsby-bloga-2/static/d93f8474c6eb516d18fe8564185495e5/a80bd/node-tiny-template.jpg 148w,\n/gatsby-bloga-2/static/d93f8474c6eb516d18fe8564185495e5/1c91a/node-tiny-template.jpg 295w,\n/gatsby-bloga-2/static/d93f8474c6eb516d18fe8564185495e5/1c72d/node-tiny-template.jpg 590w,\n/gatsby-bloga-2/static/d93f8474c6eb516d18fe8564185495e5/a8a14/node-tiny-template.jpg 885w,\n/gatsby-bloga-2/static/d93f8474c6eb516d18fe8564185495e5/fbd2c/node-tiny-template.jpg 1180w,\n/gatsby-bloga-2/static/d93f8474c6eb516d18fe8564185495e5/eec88/node-tiny-template.jpg 2880w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The CLI args allow you to pass in the ‚Äúcomponent name‚Äù which can then be used for the function declaration, the imports, the exports and test names, etc.</p>\n<p>Using the config file you can set options for casing, pascalCase, kebab-case etc and decide which files are generated and what their respective file extension should be. The ‚Äúcontent‚Äù comes from handlebars template files, which receive values generated by the module and inject them when the file is written to disk.</p>\n<p>I really thought this package was cool‚Ä¶ At least til I saw <a href=\"https://plopjs.com/\">plop</a>. Plop is a neat little boilerplate tool, and it‚Äôs great for creating templates whenever you have to be creating component files/dirs, etc. As nifty as both plop and node-tiny-template are, I do think both of these packages suffer from a faffy* initial setup‚Ä¶ which brings me back to Recipes.</p>\n<p>(*faffy is what we Brits call something that is time-consuming to do or awkward/cumbersome to make use of. Recipes are the antidote for just about any sort of faffy task you can think of!).</p>\n<h2>Next stop: Recipes as workflow?</h2>\n<p>A logical next step for Recipes is using them as a workflow. As in, a Recipe that could take care of the config for you. Then all you‚Äôd need to do is run it from the CLI and pass in, for example the ‚Äúcomponent name‚Äù.</p>\n<p>This might require there to be specific or ‚Äúopinionated‚Äù Recipes, for example you may wish to use the <code class=\"language-text\">.tsx</code> + <code class=\"language-text\">.stories</code> + <code class=\"language-text\">pascalCase</code> Recipe, or maybe <code class=\"language-text\">.js</code> + <code class=\"language-text\">.test</code> + <code class=\"language-text\">.css</code> + <code class=\"language-text\">kebab-case</code> Recipe.</p>\n<p>In either case a task such as this would require supporting documentation and remotely hosted template files. I wonder if at this point Gatsby would create a Recipe Package Manager, or <code class=\"language-text\">rpm</code> for short üòé.</p>\n<p>I‚Äôm imagining a web interface which would allow you to browse the supporting files for any given Recipe, instructions of how to use it and of course versioning!</p>\n<p>I think this would be a really nice future feature for Recipes as it allows them to exist as continuous workflow functions, rather than one-off tasks that only exist for a moment in time.</p>\n<p>I also wonder how much more widely Gatsby could indeed cast this net. I feel like Recipes would be hugely valuable outside of the Gatsby ecosystem. There are any number of projects out there that require the install and set up of <code class=\"language-text\">npm</code> modules and I for one believe Recipes would be a healthy addition to any workflow.</p>\n<p>If you have any questions, musings or just fancy a discussion about Recipes I‚Äôm always happy to chat.</p>\n<p>Feel free to come find and follow me on Twitter: <a href=\"https://twitter.com/PaulieScanlon\">@pauliescanlon</a> and say hi! üëã</p>","frontmatter":{"title":"Gatsby Recipes: What's All the Fuss About?","date":"May 21, 2020","description":null}}},"pageContext":{"slug":"/docs/blog/2020-05-21-gatsby-recipes/","previous":{"fields":{"slug":"/docs/blog/2020-05-19-little-agency-big-impact/"},"frontmatter":{"title":"Little & Big: Creating Big Impact for Small Businesses Using Gatsby"}},"next":{"fields":{"slug":"/docs/blog/2020-05-22-happy-fifth-bday-gatsby/"},"frontmatter":{"title":"It‚Äôs Gatsby‚Äôs 5th Birthday üéÇ (and everyone‚Äôs invited!)"}}}}}