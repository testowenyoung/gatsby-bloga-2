{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2020-04-29-incredimental-builds/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"293f7cd2-ea6d-5b26-831c-d96391f3b7c9","excerpt":"A few weeks ago, I published A Static Future, a post all about how sites that build at compile-time have bucketfuls of untapped potential. We pictured a world‚Ä¶","html":"<p>A few weeks ago, I published <a href=\"https://joshwcomeau.com/gatsby/a-static-future/\">A Static Future</a>, a post all about how sites that build at compile-time have bucketfuls of untapped potential.</p>\n<p>We pictured a world in which rich, dynamic web applications were built and served from static CDNs like Fastly and Cloudflare. Instead of a costly and error-prone database lookup on each request, we do the database lookups at compile-time, and re-build whenever the data changes. Instead of users pulling the latest data from our API, we push the data when it changes to the CDN.</p>\n<p>This is a really exciting vision, but it only works if builds are lightning quick. If our data changes thousands of times a day, and it takes hours to rebuild the site, the math doesn‚Äôt work.</p>\n<p>Happily, this vision has gotten significantly more tangible recently, with our <a href=\"/gatsby-bloga-2/blog/2020-04-22-announcing-incremental-builds/\">incremental builds launch</a> last week üéâ</p>\n<h2>What are incremental builds?</h2>\n<p>I think it‚Äôs best explained through an example.</p>\n<p>Let‚Äôs say we‚Äôre building an online magazine, something that mixes the content of Architectural Digest with the aesthetic of Cosmopolitan/BuzzFeed. I‚Äôve named it METROGLAM.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/7d0c03312d5b75d2498efd97ad433b88/07a9c/metroglam.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 137.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A mockup of a Cosmopolitan-style online magazine, except all the articles are about interior design and architecture\"\n        title=\"A mockup of a Cosmopolitan-style online magazine, except all the articles are about interior design and architecture\"\n        src=\"/gatsby-bloga-2/static/7d0c03312d5b75d2498efd97ad433b88/fcda8/metroglam.png\"\n        srcset=\"/gatsby-bloga-2/static/7d0c03312d5b75d2498efd97ad433b88/12f09/metroglam.png 148w,\n/gatsby-bloga-2/static/7d0c03312d5b75d2498efd97ad433b88/e4a3f/metroglam.png 295w,\n/gatsby-bloga-2/static/7d0c03312d5b75d2498efd97ad433b88/fcda8/metroglam.png 590w,\n/gatsby-bloga-2/static/7d0c03312d5b75d2498efd97ad433b88/efc66/metroglam.png 885w,\n/gatsby-bloga-2/static/7d0c03312d5b75d2498efd97ad433b88/c83ae/metroglam.png 1180w,\n/gatsby-bloga-2/static/7d0c03312d5b75d2498efd97ad433b88/07a9c/metroglam.png 1440w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We‚Äôll host each article in a CMS like WordPress or Contentful. We‚Äôll have dozens of individual authors and editors, and we expect we‚Äôll average about 15 new articles a day, with maybe 100 or so daily edits (tweaks, corrections, live updates‚Ä¶). Whenever the content changes, it triggers a new build and deploys it live.</p>\n<p>At first, this works great! Gatsby pulls all our data at build-time and generates beautiful, functional HTML files. After a couple years, though, our builds start to get a little sluggish; Once we hit 10,000 articles, it might take anywhere from 5 to 20 minutes to build.</p>\n<p>When you think about it, this is actually pretty darn quick; in that time, Gatsby is able to render every React component on every page, for each individual content item. It has to fetch all that data from the CMS, and do a bunch of other important work like optimizing and resizing images.</p>\n<p>Quick as it is, though, it‚Äôs nowhere near quick enough. Let‚Äôs imagine a scenario: you‚Äôre an author for METROGLAM, and you‚Äôve just published an article, <em>Reading Nooks To Die For</em>. Except, you realize in horror, you‚Äôve made a typo:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/b9347a16965b9a17000860cc0c2dd0eb/5faa8/typo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAACaUlEQVQoz2P4////rWtnmnoqmwoii1J8fCNic0syWltTSgOcykMc4tNDimtz2/tqWye0pmYmW0pIBloYOnlYu3m4/vv3lwGo+d61U01thYUl8cnJnoEBQSU1+ZUlkQV+lp3x1vUhChXuYlk2guZKfNLSIgoKktLSknz8PGYW5n/+/gFpfnT/akt/TXZyUFqkQ1aqf1qce2eex9xy10mphvXeYnGGXL6KLEYyvM7G8hZaUtrK0rJivGZmZr9//wZpPn7+bGCoV5yNiYOZXmGGV0Osfke8QZa3hru5UpShQKgmc7Qxt7W2iIWOmJGGqJ6ysJYcl6+LKVAjSPPhk8ctAn2j7c005aXz/bQnp5s15AQmuOrICXJZKvAUehpOSA2OdbDN8PXI8HFNdHNJdLFvTUt8efshSPPVq2ctg7zd9dQ0pETSXRV64rUrs8KCfJ3D3GzMtUTX1Xa8WHjg8dxdD+bufL/8yJN5u54t2PNkwZ5Xq0+CNF+/dsE/wMFcS1ZTTdZCWSjRQqgx3rIi0barMcPGRH1BTu27ZUfO9C4727/iXP+KG9M2Xpq0+sqUda/WnAJpPnjwgI6ajJOlpqGFvrIYv54ol6OOQoqXSXtuhL6y+Py8uv8n333ZdPnR3B13Z219On/36+VH/h988nXrVZDmHTu2y0rw2VloKKvLKwtx6Iiyawqyqgiw22gpm2jL96bmXpu8+kTnguMdC493LjzasfBo+/xLk1c/2wB29qmTJwJ83FISQv38vcO9nRPDvEK9nCPd7aLcbWL8XGOD3KOD3AN9XEP83P29XF2cne1srbPTkn7//gUA9BcE/F3ybsIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screenshot of the article, showing the title ‚ÄúReading Nooks To Die In‚Äù\"\n        title=\"Screenshot of the article, showing the title ‚ÄúReading Nooks To Die In‚Äù\"\n        src=\"/gatsby-bloga-2/static/b9347a16965b9a17000860cc0c2dd0eb/fcda8/typo.png\"\n        srcset=\"/gatsby-bloga-2/static/b9347a16965b9a17000860cc0c2dd0eb/12f09/typo.png 148w,\n/gatsby-bloga-2/static/b9347a16965b9a17000860cc0c2dd0eb/e4a3f/typo.png 295w,\n/gatsby-bloga-2/static/b9347a16965b9a17000860cc0c2dd0eb/fcda8/typo.png 590w,\n/gatsby-bloga-2/static/b9347a16965b9a17000860cc0c2dd0eb/efc66/typo.png 885w,\n/gatsby-bloga-2/static/b9347a16965b9a17000860cc0c2dd0eb/c83ae/typo.png 1180w,\n/gatsby-bloga-2/static/b9347a16965b9a17000860cc0c2dd0eb/5faa8/typo.png 1444w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Frantically, you fix the typo and hit ‚Äúpublish‚Äù‚Ä¶ But now, there‚Äôs a 20 minute wait. Your macabre typo is public, and there‚Äôs nothing you can do about it üíÄ</p>\n<p>With more engineering, we can continue to improve the speed at which we build each page, but it‚Äôll always be an O(n) problem. There will always be problems of scale. What if we had an e-commerce site with 100,000 item pages? What if we were building a blogging platform with a million pages?</p>\n<p>Incremental builds allow for lightning-quick rebuilds. The fundamental concept is the same: we generate HTML at compile-time, and store it on CDNs for quick retrieval. The difference is that we‚Äôre able to do <em>partial recompiles</em>. Instead of needing to rebuild the entire site, we can rebuild only the pages affected by the content change. When we tweak the title of an article, we only have to build the affected pages, and it can happen near-instantaneously‚Äîbuilds often complete in <strong>under 10 seconds</strong>.</p>\n<p>This effectively turns an O(n) problem into an O(1) problem. It doesn‚Äôt matter how many pages our site has because we can ignore pages that haven‚Äôt changed!</p>\n<h2>Just the beginning</h2>\n<p>This launch is a monumental step: it takes us a lot closer to the magical future described in <a href=\"https://joshwcomeau.com/gatsby/a-static-future/\">A Static Future</a>. But it‚Äôs still just the beginning.</p>\n<p>On Gatsby Cloud, we differentiate between <em>content</em> changes and <em>code</em> changes. When a content editor tweaks an article in a CMS, that triggers a content change. When a developer modifies a React component, that‚Äôs a code change. What about <a href=\"https://en.wikipedia.org/wiki/Markdown\">Markdown</a> or <a href=\"https://mdxjs.com/\">MDX</a>? For our purposes, anything that gets committed to git is a code change.</p>\n<p>Last week‚Äôs launch supports content changes with a few specific CMS providers:</p>\n<ul>\n<li>Contentful</li>\n<li>Sanity</li>\n<li>DatoCMS</li>\n<li>Cosmic</li>\n<li>WordPress (alpha)</li>\n<li>Drupal (alpha)</li>\n</ul>\n<p>In order to build incrementally, we need tight integration with the CMS to be able to detect changes. To get to the build speeds we‚Äôre after, it‚Äôs not fast enough to fetch all recent data and figure out what‚Äôs changed; we need to integrate at a lower level with the CMS, and every CMS is different.</p>\n<p>What if you‚Äôre not using one of those CMS‚Äô, or if your content is in Markdown? We hope to add full support soon, but there‚Äôs a surprising benefit even today for <em>all</em> gatsby sites.</p>\n<h2>The other half of the story</h2>\n<p>When you think about it, a sub-10-second build is wild. Have you ever heard of a webpack app being built that fast?!</p>\n<p>There‚Äôs two parts to Gatsby Cloud‚Äôs incremental builds feature:</p>\n<ol>\n<li>Figuring out which pages need to be rebuilt when specific content changes, by working out the data dependencies.</li>\n<li>Intelligent, persistent, long-running caching and parallelization.</li>\n</ol>\n<p>Each Gatsby build has a whole bunch of steps beyond fetching data from a CMS. With incremental builds, Gatsby Cloud is able to do really granular caching, and split work among many concurrent processes.</p>\n<p>Either of these steps on their own is a massive boon, but their cumulative effect is absolutely magical. It‚Äôs pretty ridiculous to watch a content-heavy site get updated live in only a few seconds.</p>\n<p>And that second half‚Äîintelligent caching and parallelization‚Äîworks for <strong>all Gatsby sites!</strong> For example, my personal blog uses MDX for its content, which is not a supported data source. Before incremental builds, it took 3-5 minutes to build. That time has shrunk to 2-3 minutes!</p>\n<h2>Pipeline tweaks required</h2>\n<p>Incremental Builds, as defined by the two parts above, is a Gatsby Cloud exclusive feature. Reasonably, some folks were a bit disappointed by this.</p>\n<p>It‚Äôs important to clarify that in order to achieve the results that we have, we <em>need</em> to own the CI/CD pipeline. This isn‚Äôt something that can be packaged in our open-source repo.</p>\n<p>Because Gatsby Cloud only has to build Gatsby sites, we can make all kinds of assumptions and optimizations around that. Other CI/CD platforms can‚Äôt optimize their cloud infrastructure for a specific kind of site, since they need to support many different build processes and application types.</p>\n<p>That said, it‚Äôs important to us that Gatsby builds quickly on all platforms! And some of this <strong>is</strong> portable. For example, there is <a href=\"/gatsby-bloga-2/docs/conditional-page-builds/\">experimental support</a> for ‚Äúconditional page builds‚Äù, to handle the content-diffing mentioned earlier.</p>\n<p>We do believe that Gatsby Cloud should be the best place to build your Gatsby project, since we‚Äôre able to make Gatsby-specific optimizations. But we also want Gatsby builds to be fast, no matter where they‚Äôre built.</p>\n<p><CloudCallout>To experience Incremental Builds for yourself:</CloudCallout></p>\n<h2>Bright days ahead</h2>\n<p>The biggest pitfall of building a static site has always been the build times.</p>\n<p>As that pitfall starts to evaporate, I‚Äôm super excited to see what kinds of developments we‚Äôll see in this area. What kinds of previously-unthinkable workflows will emerge? How broad will static pre-compilation spread?</p>\n<p>We‚Äôre still at the beginning, but it‚Äôs a big early step.</p>","frontmatter":{"title":"Incredimental Builds","date":"April 29, 2020","description":null}}},"pageContext":{"slug":"/docs/blog/2020-04-29-incredimental-builds/","previous":{"fields":{"slug":"/docs/blog/2020-04-27-building-Serverless-site-faster-with-Gatsby/"},"frontmatter":{"title":"2 Months and 2x Performance: Codebrahma accelerates Serverless.com with Gatsby"}},"next":{"fields":{"slug":"/docs/blog/2020-04-30-gatsby-web-creators-series-2/"},"frontmatter":{"title":"Gatsby Web Creators Series 2: Creative Scripting with Browser JS, Node, and React"}}}}}