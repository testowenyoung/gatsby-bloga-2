{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2019-01-31-using-react-context-api-with-gatsby/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"4039fe5f-5ecb-52b8-bd18-0ec175aa2e53","excerpt":"You often feel the unsettling flash of a bright phone screen while relaxing in a dimly lit room. This is alleviated by introducing a “dark mode” which switches…","html":"<p>You often feel the unsettling flash of a bright phone screen while relaxing in a dimly lit room. This is alleviated by introducing a “dark mode” which switches background and foreground colors to reduce eye strain. I decided to add this to my boutique web agency <a href=\"https://laccadive.io/\">Laccadive IO’s</a> new Gatsby-based site.</p>\n<Pullquote citation=\"Heydon Pickering\">\n  One of the few types of alternative theme that adds real value to users is a\n  low light intensity “night mode” theme. Not only is it easier on the eyes when\n  reading in the dark, but it also reduces the likelihood of migraine and the\n  irritation of other light sensitivity disorders. As a migraine sufferer, I’m\n  interested!\n</Pullquote>\n<p>In considering the different ways to implement this a natural fit become apparent: React’s new Context API. Having worked with Context API before, this seemed like a particularly well suited use for this API. However, I soon realized I would need to do a little set-up work to get this up and running.</p>\n<p>After a brief search, I came across just what I was looking for, the Gatsby Browser APIs. Specifically, the <a href=\"/gatsby-bloga-2/docs/browser-apis/#wrapRootElement\"><code class=\"language-text\">wrapRootElement</code></a> API was a perfect fit for this use case. This API allows you to wrap your root element with a wrapping component, e.g. a <code class=\"language-text\">Provider</code> from Redux or… a ThemeProvider from React Context. Using this, I managed to achieve dark mode for my use case.</p>\n<p>Let’s do a deep dive into how this feature was actually implemented step by step using React Context, Gatsby, and a Theme Provider to implement a dark mode UI!</p>\n<h2>Creating the Context file in a new Gatsby project</h2>\n<p>First of all, you have to initialize a Gatsby project and start it in develop mode.</p>\n<ol>\n<li>gatsby new gatsby-dark-mode</li>\n<li>cd gatsby-dark-mode</li>\n<li>npm start</li>\n</ol>\n<p>Then, create a <code class=\"language-text\">context</code> folder within src and the <code class=\"language-text\">ThemeContext.js</code> file within it.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx:title=src/context/themecontext.js\"><pre class=\"language-jsx:title=src/context/themecontext.js\"><code class=\"language-jsx:title=src/context/themecontext.js\">import React from &quot;react&quot;\n\nconst defaultState = {\n  dark: false,\n  toggleDark: () =&gt; {},\n}\n\nconst ThemeContext = React.createContext(defaultState)\n\n// Getting dark mode information from OS!\n// You need macOS Mojave + Safari Technology Preview Release 68 to test this currently.\nconst supportsDarkMode = () =&gt;\n  window.matchMedia(&quot;(prefers-color-scheme: dark)&quot;).matches === true\n\nclass ThemeProvider extends React.Component {\n  state = {\n    dark: false,\n  }\n\n  toggleDark = () =&gt; {\n    let dark = !this.state.dark\n    localStorage.setItem(&quot;dark&quot;, JSON.stringify(dark))\n    this.setState({ dark })\n  }\n\n  componentDidMount() {\n    // Getting dark mode value from localStorage!\n    const lsDark = JSON.parse(localStorage.getItem(&quot;dark&quot;))\n    if (lsDark) {\n      this.setState({ dark: lsDark })\n    } else if (supportsDarkMode()) {\n      this.setState({ dark: true })\n    }\n  }\n\n  render() {\n    const { children } = this.props\n    const { dark } = this.state\n    return (\n      &lt;ThemeContext.Provider\n        value={{\n          dark,\n          toggleDark: this.toggleDark,\n        }}\n      &gt;\n        {children}\n      &lt;/ThemeContext.Provider&gt;\n    )\n  }\n}\n\nexport default ThemeContext\n\nexport { ThemeProvider }</code></pre></div>\n<p><a href=\"https://reactjs.org/docs/context.html#reactcreatecontext\"><code class=\"language-text\">React.createContext</code></a> is a new function in React 16.3 and allows you to create a Context object. It accepts a default state, the value which will be used when a component does not have a matching Provider above it in the tree.  The function returns an object with Provider and Consumer properties which we will be using later.</p>\n<p>Create the <code class=\"language-text\">ThemeProvider</code> component which wraps its children with <code class=\"language-text\">ThemeContext.Provider</code>. This component is exported as a named export from the file.</p>\n<p>The <code class=\"language-text\">toggleDark</code> function gets the current <code class=\"language-text\">state.dark</code> value and switches the value to the opposite. It then stores the new value in <code class=\"language-text\">localStorage</code> before setting it back to state using the <code class=\"language-text\">setState</code> function, so that it persists over page refreshes. The dark value from <code class=\"language-text\">state</code> and the <code class=\"language-text\">toggleDark</code> function are passed to the Provider.</p>\n<h2>Modifying the Gatsby Browser file</h2>\n<p>Next, write the following code within the <code class=\"language-text\">gatsby-browser.js</code> file, which is in the root folder in a Gatsby project:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx:title=gatsby-browser.js\"><pre class=\"language-jsx:title=gatsby-browser.js\"><code class=\"language-jsx:title=gatsby-browser.js\">import React from &quot;react&quot;\n\nimport { ThemeProvider } from &quot;./src/context/ThemeContext&quot;\n\n// highlight-start\nexport const wrapRootElement = ({ element }) =&gt; (\n  &lt;ThemeProvider&gt;{element}&lt;/ThemeProvider&gt;\n)\n// highlight-end</code></pre></div>\n<p>The <code class=\"language-text\">ThemeProvider</code> component exported from the <code class=\"language-text\">ThemeContext.js</code> file wraps the root element and is exported as <code class=\"language-text\">wrapRootElement</code>. This API is then invoked appropriately by the Gatsby API runner.</p>\n<h2>Editing the Layout file</h2>\n<p>The default <code class=\"language-text\">layout.js</code> uses a <code class=\"language-text\">&lt;staticQuery&gt;</code> and renderProp to render the layout, which is wrapped by a Fragment <code class=\"language-text\">&lt;&gt;</code>. Modify it to look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx:title=src/components/layout.js\"><pre class=\"language-jsx:title=src/components/layout.js\"><code class=\"language-jsx:title=src/components/layout.js\">import * as React from &#39;react&#39;\nimport PropTypes from &#39;prop-types&#39;\nimport { StaticQuery, graphql } from &#39;gatsby&#39;\n\nimport ThemeContext from &#39;../context/ThemeContext&#39;\nimport Header from &#39;./header&#39;\nimport &#39;./layout.css&#39;\n\nconst Layout = ({ children }) =&gt; (\n  &lt;StaticQuery\n    query={graphql`\n      query SiteTitleQuery {\n        site {\n          siteMetadata {\n            title\n          }\n        }\n      }\n    `}\n    render={data =&gt; (\n      {/* highlight-start */}\n      &lt;ThemeContext.Consumer&gt;\n        {theme =&gt; (\n          &lt;div className={theme.dark ? &#39;dark&#39; : &#39;light&#39;}&gt;\n      {/* highlight-end */}\n            &lt;Header siteTitle={data.site.siteMetadata.title} /&gt;\n            &lt;div\n              style={{\n                margin: `0 auto`,\n                maxWidth: 960,\n                padding: `0px 1.0875rem 1.45rem`,\n                paddingTop: 0,\n              }}\n            &gt;\n              {children}\n              &lt;footer&gt;\n                © {new Date().getFullYear()}, Built with\n                {` `}\n                &lt;a href=&quot;https://www.gatsbyjs.org&quot;&gt;Gatsby&lt;/a&gt;\n              &lt;/footer&gt;\n            &lt;/div&gt;\n          &lt;/div&gt;\n        )}\n      &lt;/ThemeContext.Consumer&gt;\n    )}\n  /&gt;\n)\n\nLayout.propTypes = {\n  children: PropTypes.node.isRequired,\n}\n\nexport default Layout</code></pre></div>\n<p>The class of the wrapper div will change based on the context value of the dark variable, which we set as state in the <code class=\"language-text\">ThemeContext.js</code> file.</p>\n<h2>Adding the switch in the Header</h2>\n<p>With this configuration completed, we can now add the actual switch to toggle dark mode. Modify the <code class=\"language-text\">header.js</code> component, like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx:title=src/components/header.js\"><pre class=\"language-jsx:title=src/components/header.js\"><code class=\"language-jsx:title=src/components/header.js\">import { Link } from &quot;gatsby&quot;\nimport PropTypes from &quot;prop-types&quot;\nimport React from &quot;react&quot;\n\nimport ThemeContext from &quot;../context/ThemeContext&quot;\n\nconst Header = ({ siteTitle }) =&gt; (\n  &lt;ThemeContext.Consumer&gt;\n    {theme =&gt; (\n      &lt;div\n        style={{\n          background: `rebeccapurple`,\n          marginBottom: `1.45rem`,\n        }}\n      &gt;\n        &lt;div\n          style={{\n            margin: `0 auto`,\n            maxWidth: 960,\n            padding: `1.45rem 1.0875rem`,\n          }}\n        &gt;\n          &lt;h1 style={{ margin: 0 }}&gt;\n            &lt;Link\n              to=&quot;/&quot;\n              style={{\n                color: `white`,\n                textDecoration: `none`,\n              }}\n            &gt;\n              {siteTitle}\n            &lt;/Link&gt;\n          &lt;/h1&gt;\n          &lt;button className=&quot;dark-switcher&quot; onClick={theme.toggleDark}&gt;\n            {theme.dark ? &lt;span&gt;Light mode ☀&lt;/span&gt; : &lt;span&gt;Dark mode ☾&lt;/span&gt;}\n          &lt;/button&gt;\n        &lt;/div&gt;\n      &lt;/div&gt;\n    )}\n  &lt;/ThemeContext.Consumer&gt;\n)\n\nHeader.propTypes = {\n  siteTitle: PropTypes.string,\n}\n\nHeader.defaultProps = {\n  siteTitle: ``,\n}\n\nexport default Header</code></pre></div>\n<h2>Adding styles</h2>\n<p>At this point, we’ve set up a dark mode toggle and conditionally render a <code class=\"language-text\">className</code> if dark mode is enabled. However, we still need to actually <em>style</em> based upon this conditional <code class=\"language-text\">className</code>. As such, we need to add the following styles in the <code class=\"language-text\">layout.css</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"css:title=src/components/layout.css\"><pre class=\"language-css:title=src/components/layout.css\"><code class=\"language-css:title=src/components/layout.css\">/* Dark mode styles */\n.dark-switcher {\n  color: #fff;\n  margin-top: 5px;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n}\n\n@media (min-width: 992px) {\n  .dark-switcher {\n    position: absolute;\n    right: 15px;\n    top: 10px;\n  }\n}\n\n.dark {\n  background-color: #2a2b2d;\n  color: #fff;\n  transition: all 0.6s ease;\n}\n\n.light {\n  transition: all 0.6s ease;\n  background-color: #fefefe;\n}\n\n.dark a,\n.dark a:visited {\n  color: #fff;\n}</code></pre></div>\n<h2>Conclusion</h2>\n<p>In just a few, simple steps we’ve enabled a conditional dark mode that our users will certainly appreciate. We’ve leveraged APIs like <code class=\"language-text\">Context</code> in React, as well as internal Gatsby APIs to wrap our code with a provider. Now if you visit <code class=\"language-text\">http://localhost:8000/</code> you can see all of our work pay off!</p>\n<p>We covered the following in today’s article:</p>\n<ul>\n<li>Introduction to dark mode in web development</li>\n<li>Initializing a Gatsby project</li>\n<li>Initializing the context object with <code class=\"language-text\">createContext</code></li>\n<li>Using the Gatsby Browser API and returning <code class=\"language-text\">wrapRootElement</code> from <code class=\"language-text\">gatsby-browser.js</code></li>\n<li>Wrapping the JSX within <code class=\"language-text\">layout.js</code> with a Context Consumer and a div with class referring to the dark mode state</li>\n<li>Adding the switch inside the header</li>\n<li>Adding the styles relevant to the Dark mode</li>\n</ul>\n<p>Interested in seeing this in action? Head over to <a href=\"https://github.com/m-muhsin/gatsby-dark-mode\">https://github.com/m-muhsin/gatsby-dark-mode</a> and clone or fork my project.</p>","frontmatter":{"title":"Using React Context API with Gatsby","date":"January 31, 2019","description":null}}},"pageContext":{"slug":"/docs/blog/2019-01-31-using-react-context-api-with-gatsby/","previous":{"fields":{"slug":"/docs/blog/2019-01-31-why-themes/"},"frontmatter":{"title":"Why Themes?"}},"next":{"fields":{"slug":"/docs/blog/2019-02-05-hapticmedia-case-study/"},"frontmatter":{"title":"Beyond Static: Hapticmedia Uses Gatsby to Build a Dynamic Web App"}}}}}