{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2018-10-26-export-a-drupal-site-to-gatsby/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"2fc1cb91-bbc0-5b61-8751-74e57c6dca31","excerpt":"This blogpost explains how I learned to reduce the cost of maintaining a simple brochure or blog site. When using Drupal, you need at least a shared hosting…","html":"<p>This blogpost explains how I learned to reduce the cost of maintaining a simple brochure or blog site. When using Drupal, you need at least a shared hosting platform (there is no Wordpress.com for Drupal sites). So, migrating to a static site generator, like Jekyll or Gatsby, seemed like a good idea. Gatsby is also a great opportunity to learn React and then get hosting for free using something like GitHub Pages. This post is going to describe how to migrate a simple blog—that has featured images on the posts, comments and tags—from Drupal to Gatsby.</p>\n<p>To facilitate exporting the site, the first thing I did was export the database from the mysql database server to a sqlite file that I could use locally. To do this I used the <a href=\"https://github.com/dumblob/mysql2sqlite\">mysql2sqlite</a> project, which, as described on the project page, can be done with two commands like:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">mysqldump --skip-extended-insert --compact DB_name <span class=\"token operator\">></span> dump_mysql.sql\n./mysql2sqlite dump_mysql.sql <span class=\"token operator\">|</span> sqlite3 mysqlite.db</code></pre></div>\n<h2>How to export a Drupal site to Gatsby yourself</h2>\n<p>To do this yourself, you’ll build a simple blog using the excellent <a href=\"https://github.com/gatsbyjs/gatsby-starter-blog\">gatsby-starter-blog</a> project. Create a new project and then add a <a href=\"https://github.com/JoshuaWise/better-sqlite3\">sqlite library</a> as a dev dependency:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gatsby new gatsby-blog https://github.com/gatsbyjs/gatsby-starter-blog\n<span class=\"token function\">git</span> init <span class=\"token comment\"># so you can keep track of the changes</span>\n<span class=\"token function\">npm</span> i <span class=\"token comment\"># to install regular gastby requirements</span>\n<span class=\"token function\">npm</span> i --save-dev better-sqlite3 <span class=\"token comment\"># to add an sqlite javascript client</span></code></pre></div>\n<p>The useful commands on a sqlite3 command line to explore are <code class=\"language-text\">.tables</code> to see all tables :) and <code class=\"language-text\">.schema table_name</code> to see information about a specific table. Oh! and <code class=\"language-text\">.help</code> to know more.</p>\n<p>Next, you will be creating a new file on your project at <code class=\"language-text\">src/scripts/import.js</code>. Initially, what you want is to iterate through all your posts and export basic data like title, created date, body and status (published or draft). All of that data is in two tables, the <em>node</em> table and the <em>field</em>data<em>body</em>. Initially, your script will look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Database <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'better-sqlite3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> http <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'http'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// argv[2] would be the first argument passed to > node src/scripts/import.js [database.db]</span>\n<span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Database</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>readonly<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> rows <span class=\"token operator\">=</span> db<span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">SELECT n.nid, n.title, n.created, b.body_value, n.status FROM node n\n  INNER JOIN field_data_body b ON b.entity_id = n.nid</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nrows<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">row</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// taken from: https://gist.github.com/matthagemann/382adfc57adbd5af078dc93feef01fe1</span>\n  <span class=\"token keyword\">const</span> slug <span class=\"token operator\">=</span> <span class=\"token function\">slugify</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> folder <span class=\"token operator\">=</span> row<span class=\"token punctuation\">.</span>status <span class=\"token operator\">?</span> <span class=\"token string\">'/../pages/'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'/../../drafts/'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> __dirname <span class=\"token operator\">+</span> folder <span class=\"token operator\">+</span> slug<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// timestamp in Drupal is in seconds, Date() expects microseconds</span>\n  <span class=\"token keyword\">const</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>created <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The interesting thing here is the initial query, and this is based on a Drupal 7 database. A Drupal 8 or Drupal 6 database could be different, so check your schema. Next, load the tags on a simple JavaScript array. Each post can have more than one tag, so you can take advantage of better-sqlite’s <em>.pluck()</em> function, which retrieves only the first column of a database query, and the <em>.all()</em> function, which retrieves all rows in a single array:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> tags <span class=\"token operator\">=</span> db\n  <span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">SELECT td.name FROM taxonomy_index ti\n    INNER JOIN taxonomy_term_data td ON td.tid = ti.tid AND ti.nid = ?\n    WHERE ti.tid NOT IN (SELECT tid FROM taxonomy_index GROUP BY tid HAVING count(nid) = 1)</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">pluck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>nid<span class=\"token punctuation\">)</span></code></pre></div>\n<p>To avoid 404 in case you created some url aliases you can query the <code class=\"language-text\">url_alias</code> table and create an aliases frontmatter property and later (depending on your hosting platform) use a plugin like <a href=\"https://github.com/nsresulta/gatsby-plugin-meta-redirect\">gatsby-plugin-meta-redirect</a> to use the gatsby <a href=\"https://www.gatsbyjs.org/docs/actions/#createRedirect\">createRedirect</a> function:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> aliases <span class=\"token operator\">=</span> db\n  <span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">SELECT alias FROM url_alias\n    WHERE source = ? AND alias != ?</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">pluck</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"node/\"</span> <span class=\"token operator\">+</span> row<span class=\"token punctuation\">.</span>nid<span class=\"token punctuation\">,</span> slug<span class=\"token punctuation\">)</span></code></pre></div>\n<p>For the image, you will retrieve only the URL of the image, so you can download it and store it locally. And you will replace <code class=\"language-text\">public://</code> for the URL path of the images folder on your old site:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">let</span> image <span class=\"token operator\">=</span> db\n  <span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">SELECT filename, uri FROM field_data_field_image i\n    INNER JOIN file_managed f ON f.fid = i.field_image_fid\n    WHERE i.entity_id = ?</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>nid<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  image<span class=\"token punctuation\">.</span>uri <span class=\"token operator\">=</span> image<span class=\"token punctuation\">.</span>uri<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"public://\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"http://myblog.com/files/\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And now that you have all the data you need, it is just a matter of creating a file with the metadata in YAML format and the body of the text in Markdown format. Luckily, a Drupal blog can also use Markdown or you can also look for an HTML to Markdown JavaScript library like <a href=\"https://github.com/domchristie/turndown\">turndown</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  fs<span class=\"token punctuation\">.</span><span class=\"token function\">mkdir</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> file <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">createWriteStream</span><span class=\"token punctuation\">(</span>path <span class=\"token operator\">+</span> <span class=\"token string\">'/index.md'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> flags<span class=\"token operator\">:</span> <span class=\"token string\">'w'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// This is here incase any errors occur</span>\n  file<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'open'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    file<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'---\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    file<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'title: \"'</span> <span class=\"token operator\">+</span> row<span class=\"token punctuation\">.</span>title <span class=\"token operator\">+</span> <span class=\"token string\">'\"\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    file<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'date: '</span> <span class=\"token operator\">+</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    file<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'aliases: '</span> <span class=\"token operator\">+</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>aliases<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    file<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'tags: '</span> <span class=\"token operator\">+</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>tags<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    file<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token string\">'---\\n\\n'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// taken from: https://stackoverflow.com/a/22907134/9055</span>\n      <span class=\"token function\">download</span><span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">.</span>uri<span class=\"token punctuation\">,</span> path <span class=\"token operator\">+</span> <span class=\"token string\">'/'</span> <span class=\"token operator\">+</span> image<span class=\"token punctuation\">.</span>filename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      file<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">![</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>image<span class=\"token punctuation\">.</span>filename<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">](./</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>image<span class=\"token punctuation\">.</span>filename<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)\\n\\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    file<span class=\"token punctuation\">.</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>body_value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    file<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">,</span> slug<span class=\"token punctuation\">,</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>aliases<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ndb<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This script is now finished and you can execute it in your shell with this command:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">node src/scripts/import.js mysqlite.db</code></pre></div>\n<p>To have comments on your site you can use a service like <a href=\"https://disqus.com/\">Disqus</a>. Disqus has an import process that uses a <a href=\"https://help.disqus.com/developer/custom-xml-import-format\">custom XML import format</a> based on the WXR (WordPress eXtended RSS) schema. So the process would be the same. Create a script named <code class=\"language-text\">src/scripts/export_comments.js</code> to query the database and, in this case, write a single file containing all the comments of your old site:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Database <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"better-sqlite3\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fs\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> yourSite <span class=\"token operator\">=</span> <span class=\"token string\">\"https://username.github.io/yoursite/\"</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">.</span>length <span class=\"token operator\">&lt;</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">usage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  process<span class=\"token punctuation\">.</span><span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> db <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Database</span><span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>argv<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> readonly<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> rows <span class=\"token operator\">=</span> db\n  <span class=\"token punctuation\">.</span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">SELECT n.nid, n.title, n.created, b.body_value, n.status,\n  c.cid, c.pid, c.name, c.mail, c.created created_comment, c.homepage, c.hostname, c.subject, cb.comment_body_value\n  FROM node n\n  INNER JOIN field_data_body b ON b.entity_id = n.nid\n  INNER JOIN comment c ON c.nid = n.nid AND c.status = 1\n  INNER JOIN field_data_comment_body cb ON cb.entity_id = c.cid\n  ORDER BY n.nid, c.cid</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?>\n&lt;rss version=\"2.0\"\n  xmlns:content=\"http://purl.org/rss/1.0/modules/content/\"\n  xmlns:dsq=\"http://www.disqus.com/\"\n  xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n  xmlns:wp=\"http://wordpress.org/export/1.0/\"\n>\n  &lt;channel></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> previous_slug <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\nrows<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">row</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> slug <span class=\"token operator\">=</span> <span class=\"token function\">slugify</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> date <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>created <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> date_comment <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span>created_comment <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>slug <span class=\"token operator\">!=</span> previous_slug<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>previous_slug <span class=\"token operator\">!=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;/item></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;item>\n      &lt;title></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/title>\n      &lt;link></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>yourSite<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>slug<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/link>\n      &lt;content:encoded>&lt;![CDATA[</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>body_value<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]]>&lt;/content:encoded>\n      &lt;dsq:thread_identifier></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>nid<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/dsq:thread_identifier>\n      &lt;wp:post_date_gmt></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getDisqusDate</span><span class=\"token punctuation\">(</span>date<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/wp:post_date_gmt>\n      &lt;wp:comment_status>open&lt;/wp:comment_status></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    previous_slug <span class=\"token operator\">=</span> slug\n  <span class=\"token punctuation\">}</span>\n\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    &lt;wp:comment>\n      &lt;wp:comment_id></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>cid<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/wp:comment_id>\n      &lt;wp:comment_author></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/wp:comment_author>\n      &lt;wp:comment_author_email></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>mail<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/wp:comment_author_email>\n      &lt;wp:comment_author_url></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>homepage<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/wp:comment_author_url>\n      &lt;wp:comment_author_IP></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>hostname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/wp:comment_author_IP>\n      &lt;wp:comment_date_gmt></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getDisqusDate</span><span class=\"token punctuation\">(</span>date_comment<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/wp:comment_date_gmt>\n      &lt;wp:comment_content>&lt;![CDATA[</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>\n        row<span class=\"token punctuation\">.</span>comment_body_value\n      <span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]]>&lt;/wp:comment_content>\n      &lt;wp:comment_approved>1&lt;/wp:comment_approved>\n      &lt;wp:comment_parent></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>row<span class=\"token punctuation\">.</span>pid<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/wp:comment_parent>\n    &lt;/wp:comment>\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;/item>&lt;/channel>&lt;/rss></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\ndb<span class=\"token punctuation\">.</span><span class=\"token function\">close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">usage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> scriptName <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">basename</span><span class=\"token punctuation\">(</span>__filename<span class=\"token punctuation\">)</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"node \"</span> <span class=\"token operator\">+</span> scriptName <span class=\"token operator\">+</span> <span class=\"token string\">\" &lt;database.sqlite>\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">getDisqusDate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">date</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    date<span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">\" \"</span> <span class=\"token operator\">+</span> date<span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">19</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">slugify</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> <span class=\"token string\">\"àáäâãåèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ·/_,:;\"</span>\n  <span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> <span class=\"token string\">\"aaaaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------\"</span>\n  <span class=\"token keyword\">const</span> p <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"|\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"g\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> string\n    <span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\s+/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Replace spaces with</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">,</span> <span class=\"token parameter\">c</span> <span class=\"token operator\">=></span> b<span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Replace special characters</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/&amp;/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-and-\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Replace &amp; with ‘and’</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[^\\w\\-]+/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Remove all non-word characters</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\-\\-+/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Replace multiple — with single -</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/^-+/</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Trim — from start of text .replace(/-+$/, '') // Trim — from end of text</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Run <code class=\"language-text\">node src/scripts/export_comments.js ../mysqlite.db &gt; comments.xml</code> and that’s it. This will generate a <strong>comments.xml</strong> file that you can <a href=\"https://import.disqus.com/\">import into disqus</a>. Just remember to change the <strong>yourSite</strong> variable in the script, and it will link each comment to the correct post in your new blog using the slug used in the posts import.</p>\n<p>You now have all the posts and all comments ready to be used on your Gatsby blog. You can see a working example here: <a href=\"https://github.com/jackbravo/joaquin.axai.mx\">https://github.com/jackbravo/joaquin.axai.mx</a>.</p>","frontmatter":{"title":"How to export a Drupal site to Gatsby","date":"December 18, 2018","description":null}}},"pageContext":{"slug":"/docs/blog/2018-10-26-export-a-drupal-site-to-gatsby/","previous":{"fields":{"slug":"/docs/blog/2018-12-17-ibm-case-study/"},"frontmatter":{"title":"IBM Uses Gatsby to Manage Enterprise-Level Content"}},"next":{"fields":{"slug":"/docs/blog/2018-11-03-building-an-accessible-lightbox/"},"frontmatter":{"title":"Building a custom, accessible image lightbox"}}}}}