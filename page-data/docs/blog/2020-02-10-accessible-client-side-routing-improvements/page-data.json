{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2020-02-10-accessible-client-side-routing-improvements/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"d86995c2-ef17-5c61-9072-c3e2003bf39c","excerpt":"We recently released accessibility improvements to client side routing in Gatsby core, building on previous focus management improvements released in version…","html":"<p>We recently released accessibility improvements to client side routing in Gatsby core, building on previous focus management improvements <a href=\"https://github.com/gatsbyjs/gatsby/pull/13197\">released in version 2.13.2</a>. These improvements enable people relying on screen readers to successfully navigate sites built with Gatsby. If you’d like an in-depth look at how we made incremental changes to get to this release, have a look at the conversation in this <a href=\"https://github.com/gatsbyjs/gatsby/issues/5581\">issue about assistive technology and navigation</a>. It was opened way back in May 2018.</p>\n<p>In July of 2019, Marcy Sutton teamed up with <a href=\"https://www.makeitfable.com/\">Fable Tech Labs</a> to conduct user testing to determine the best user experience for navigating JavaScript applications. Marcy wrote a thorough <a href=\"/gatsby-bloga-2/blog/2019-07-11-user-testing-accessible-client-routing/\">blog post</a> about that research. This left us with some concrete recommendations to execute on:</p>\n<ul>\n<li>Provide a skip link that takes focus on a route change within the site, with a label that indicates what the link will do when activated: e.g. “skip to main navigation”.</li>\n<li>Include an <a href=\"https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Live_Regions\">ARIA Live Region</a> on page load. On a route change, append text to it indicating the current page, e.g. “Portfolio page”.</li>\n</ul>\n<h2>Some Background</h2>\n<p>Our first step to addressing focus management (the first recommendation, above) was <a href=\"/gatsby-bloga-2/blog/2018-09-27-reach-router/\">switching</a> to <a href=\"https://reach.tech/router\"><code class=\"language-text\">@reach/router</code></a>. This got us part of the way there out-of-the-box. However, Gatsby’s implementation of <code class=\"language-text\">@reach/router</code> isn’t idiomatic in that Gatsby puts everything on a single, catch-all route. This means that every page is technically on the same route and route changes weren’t getting picked up by <code class=\"language-text\">@reach/router</code>. Our improvements in <a href=\"https://github.com/gatsbyjs/gatsby/pull/13197\">2.13.2</a> made sure that every time a route changed, we reset focus on a wrapping <code class=\"language-text\">div</code>. These changes also ensure that our single, catch-all route is dynamic so we can register changes and take advantage of <code class=\"language-text\">@reach/router’s</code> strengths. Both of these changes were a major improvement for most users, but because some assistive technologies (NVDA and VoiceOver in particular) were still not working, we kept <a href=\"https://github.com/gatsbyjs/gatsby/issues/5581\">issue 5581</a> open and continued to make incremental changes over time.</p>\n<p>While this work prioritizes screen reader users, we are still far from the most accessible solution for other disabilities. For example, users who rely on magnification, voice navigation users, and users relying on switches (devices that replace the need to use a keyboard or a mouse) have a hard time orienting themselves on a new page if focus is set on too large of an element or an inoperable element (like our wrapper <code class=\"language-text\">div</code>). Sending focus directly to a smaller, interactive control like a skip link is ideal. Unfortunately, we’re limited with what we can programmatically achieve at the framework level (we have no way of knowing if a skip link exists on site pages from our <code class=\"language-text\">Router</code>).</p>\n<p>For this reason, we recommend that developers take control of focus themselves and assert the functionality in <a href=\"/gatsby-bloga-2/docs/end-to-end-testing/#writing-tests\">automated tests</a>. We encourage you to take advantage of <code class=\"language-text\">@reach/router’s</code> <a href=\"https://reacttraining.com/reach-ui/skip-nav/\">skip nav functionality</a> (or implement a skip link yourself) on your site.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx:title=layout.js\"><pre class=\"language-jsx:title=layout.js\"><code class=\"language-jsx:title=layout.js\">import { SkipNavLink, SkipNavContent } from &quot;@reach/skip-nav&quot;\nimport &quot;@reach/skip-nav/styles.css&quot; //this will auto show and hide the link on focus\n\nconst Layout = ({ children }) =&gt; {\n  return (\n    &lt;React.Fragment&gt;\n      &lt;SkipNavLink /&gt;\n      &lt;header&gt;\n        &lt;h3&gt;Welcome to my site&lt;/h3&gt;\n      &lt;/header&gt;\n      &lt;SkipNavContent /&gt;\n      &lt;main&gt;{children}&lt;/main&gt;\n      &lt;footer&gt;\n        © {new Date().getFullYear()}, Built with\n        {` `}\n        &lt;a href=&quot;https://www.gatsbyjs.org&quot;&gt;Gatsby&lt;/a&gt;\n      &lt;/footer&gt;\n    &lt;/React.Fragment&gt;\n  )\n}</code></pre></div>\n<p>Then you can make sure focus is directed there in your <code class=\"language-text\">gatsby-browser.js</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript:title=gatsby-browser.js\"><pre class=\"language-javascript:title=gatsby-browser.js\"><code class=\"language-javascript:title=gatsby-browser.js\">exports.onRouteUpdate = ({ location, prevLocation }) =&gt; {\n  if (prevLocation !== null) {\n    const skipLink = document.querySelector(&quot;#reach-skip-nav&quot;)\n    if (skipLink) {\n      skipLink.focus()\n    }\n  }\n}</code></pre></div>\n<p><strong>Note:</strong> After noticing that Gatsby’s .org site was missing this, I whipped up a <a href=\"https://github.com/gatsbyjs/gatsby/pull/21108\">Pull Request</a> to facilitate a design discussion and work through real-world feedback. Incremental improvements are so important!</p>\n<h2>New Improvements</h2>\n<p>The changes that were shipped in <a href=\"https://github.com/gatsbyjs/gatsby/pull/19290\">PR #19290</a> address the recommendation to add an ARIA live region that announces route changes. Using <code class=\"language-text\">@reach-router</code> alone got us most of the way there depending on which browser and screen reader combination someone is using; for most combinations, page content would be communicated when changing routes. However, we found that two of the <a href=\"https://webaim.org/projects/screenreadersurvey8/#browsercombos\">most popular</a> combinations (NVDA with Firefox and VoiceOver with Safari) weren’t announcing anything at all on client-side route changes. This leads to a confusing experience where users are unsure which page they are on and unsure if links are working. Implementing our ARIA live region ensures that there is consistent and reliable behavior regardless of the technologies used.</p>\n<p>Our solution appends a <code class=\"language-text\">RouteAnnouncer</code> component as a sibling of our main focus wrapper.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">React.Fragment</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\"> //gatsby-focus-wrapper\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">RouteAnnouncer</span></span> <span class=\"token attr-name\">location</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">React.Fragment</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>The <code class=\"language-text\">RouteAnnouncer</code> is a component that renders an ARIA live region. This region has <code class=\"language-text\">aria-live</code> set to <code class=\"language-text\">assertive</code> because we want route changes to always interrupt whatever the screen reader is currently doing. We’ve also set <code class=\"language-text\">aria-atomic</code> to true because we want every change to the content of this <code class=\"language-text\">div</code> to be announced. Our ARIA live region has inline styles to hide it visually, as recommended by <a href=\"https://webaim.org/techniques/css/invisiblecontent/#offscreen\">WebAIM</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n  <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>gatsby-announcer<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n    position<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">absolute</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    top<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    width<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    height<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    padding<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    overflow<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">hidden</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    clip<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">rect(0, 0, 0, 0)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    whiteSpace<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">nowrap</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    border<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">aria-live</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>assertive<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">aria-atomic</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>announcementRef<span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>This component sets the content to be announced (e.g. “Navigated to Gatsby Blog”) by targeting the <code class=\"language-text\">innerText</code> on the <code class=\"language-text\">gatsby-announcer</code> div, selected by <code class=\"language-text\">ref</code>. Using a React <code class=\"language-text\">ref</code> and only updating the announcement text if it is different from the current announcement text prevents screen readers from repeating announcements if the page renders multiple times.</p>\n<p>One limitation of implementing this at the framework level is that we don’t have access to what ultimately ends up on the pages, as they can be sourced from anywhere. For this reason, the announcement will always start with “Navigated to”, followed by either the content of the first <code class=\"language-text\">h1</code> on the page, the <code class=\"language-text\">title</code> of the page, or <code class=\"language-text\">location.path</code> depending on what is present. Additionally, the differences between framework level and “userland” changes were evident when testing behavior compared to sites implementing similar changes themselves (e.g. Marcy Sutton’s <a href=\"https://github.com/marcysutton/gatsby-a11y-workshop/blob/master/examples/client-side-routing/gatsby-browser.js\">example solution</a> as part of her <a href=\"https://github.com/marcysutton/gatsby-a11y-workshop\">gatsby-a11y-workshop</a>) and finding that the framework-level implementation had less consistent behavior and bugs with repetition.</p>\n<h2>What’s Next</h2>\n<p>Now that this large improvement is shipped, we’ll continue building on our progress. Right now the English words “Navigated to” appear in every announcement. Because accessible solutions are meant to be <a href=\"https://developer.mozilla.org/en-US/docs/Web/Accessibility/Understanding_WCAG/Understandable\">understandable</a>, we aim to localize this string based on the language in which a user is navigating the web in (see <a href=\"https://github.com/gatsbyjs/gatsby/issues/20801\">issue 20801</a>). Additionally, we would like to offer additional customization for users, offering the option to specify an element to grab announcement text from instead of the <code class=\"language-text\">h1</code> or <code class=\"language-text\">title</code> on the page (see <a href=\"https://github.com/gatsbyjs/gatsby/issues/21059\">issue 21059</a>).</p>\n<p>As always, we’d love to hear ideas and suggestions from the community on existing and/or new issues in the <a href=\"https://github.com/gatsbyjs/gatsby\">Gatsby GitHub repo</a>.</p>","frontmatter":{"title":"Accessibility Improvements to Client Side Routing in Gatsby - Available in 2.19.8","date":"February 10, 2020","description":null}}},"pageContext":{"slug":"/docs/blog/2020-02-10-accessible-client-side-routing-improvements/","previous":{"fields":{"slug":"/docs/blog/100days/serverless/"},"frontmatter":{"title":"Challenge 6 - Use Serverless Functions and Services to Collect Form Data"}},"next":{"fields":{"slug":"/docs/blog/2020-02-11-founding-organizations/"},"frontmatter":{"title":"Founding Organizations: Creating a Company That Sustains Our Open-Source Community"}}}}}