{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2018-04-11-trying-out-gatsby-at-work-and-co/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"6dbf2a38-2493-5bc7-8295-c3fd3e623642","excerpt":"As a developer, it’s always exciting to try something new. When working with a technology for the first time, I usually ask myself two questions: What can this…","html":"<p>As a developer, it’s always exciting to try something new. When working with a technology for the first time, I usually ask myself two questions: What can this do for me now, and what will it bring to my future projects?</p>\n<p>Most recently, I had the opportunity to lead the first Gatsby project at Work &#x26; Co. <a href=\"https://work.co\">Work &#x26; Co</a> is a digital product agency. Our goal is to design and develop engaging user experiences, ranging from websites to mobile applications to e-commerce platforms to chatbots.</p>\n<p>Our project was to build a new website for <a href=\"https://www.whittleschool.org/en\">Whittle School &#x26; Studios</a>. Whittle is an innovative educator that will soon open campuses in the United States and China.</p>\n<video controls=\"controls\" autoplay=\"true\" loop=\"true\">\n  <source type=\"video/mp4\" src=\"/gatsby-bloga-2/168223eae6bdbd438c55c119744ed326/whittle.mp4\" />\n  <p>Your browser does not support the video element.</p>\n</video>\n<p>We had a blast building the site, and learned a lot about Gatsby in the process. This post will take you through the different parts of our journey:</p>\n<ul>\n<li><a href=\"#choosing-a-stack\">Choosing a stack</a></li>\n<li><a href=\"#creating-a-gatsby-workflow\">Creating a Gatsby workflow</a></li>\n<li><a href=\"#contributing-to-gatsby\">Contributing to Gatsby</a></li>\n</ul>\n<h2>Choosing a stack</h2>\n<h3>Requirements</h3>\n<p>We started the project with two key requirements:</p>\n<h4>1. CMS-powered content</h4>\n<p>As a content-heavy site, the project would need a CMS. Our choice here was <a href=\"https://www.contentful.com/\">Contentful</a>, a tool we’d used successfully on a few other products. We set up three Contentful spaces — for development, QA, and production/staging — with scripts to copy models and content between spaces as needed.</p>\n<h4>2. Static site generation</h4>\n<p>We also knew that the site would eventually need to launch in both the US and China. This came with a bunch of unknowns on the China side of things: Could we rely on the same build system and CDN for all locales, or would China require a unique setup to account for server performance discrepancies and possible API restrictions?</p>\n<p>We didn’t know, and we weren’t going to know for some time, because most of these decisions were going to be made by an external vendor. Not wanting to back ourselves into a corner, we decided to use a static site generator. No matter what devops we wound up with, we could bank on compiling static files and putting them <em>somewhere</em>.</p>\n<p>All of this begged the question: “What’s a good static site generator that works with Contentful?”</p>\n<h3>Enter Gatsby</h3>\n<p>I’d already heard a bit about Gatsby, and as I looked into it further, I noticed a few things that got me really excited:</p>\n<h4>Old friends</h4>\n<p>Gatsby is built on React, something our team already knows and likes. We use React (or React Native) for most of our projects at Work &#x26; Co because we love the declarative syntax, lifecycle hooks, and modular architecture. In addition to React, Gatsby is compatible with several modern CSS strategies, including our favorite: CSS Modules.</p>\n<h4>Prefetched pages ⚡️</h4>\n<p>When we decided to use a static site generator, we assumed we’d be building a classic <em>static site</em>, with each route change requesting brand new HTML from the server. For a small, simple site, we thought this was good enough, but Gatsby gave us one better: pre-fetching, out of the box. This meant that our site would feel like a single page app while still benefiting from the flexibility and improved performance of a static site.</p>\n<h4>Contentful support</h4>\n<p>Gatsby’s <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/examples/using-contentful\"><code class=\"language-text\">using-contentful</code></a> sample project made it very easy to get started with the <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-source-contentful\"><code class=\"language-text\">gatsby-source-contentful</code></a> plugin. The code demonstrated how to generate dynamic URLs and support multiple Contentful locales, which was exactly what we wanted to do!</p>\n<h4>GraphQL</h4>\n<p>Getting to play with GraphQL was a definite plus (I’d been jealous of coworkers using it on other projects!), and the built-in GraphiQL query constructor helped us all get used to the syntax. GraphQL was a natural fit for traversing Contentful relationships, and Gatsby’s implementation allowed us take advantage of the Contentful image API to automatically crop our assets.</p>\n<h3>Putting it all together</h3>\n<p>As I mentioned, Gatsby’s <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/examples/using-contentful\"><code class=\"language-text\">using-contentful</code></a> sample project already took us several steps in the right direction; the only outstanding question was how to support a more complex data structure.</p>\n<p>My last project involving CMS integration was <a href=\"https://www.aldoshoes.com\">Aldo</a>, a Work &#x26; Co designed and developed e-commerce and content site that launched in 2017. Here, we used a modular CMS strategy, where CMS-driven pages were basically stacks of modules that editors could mix and match.</p>\n<p>I planned to use a similar technique for this project; we would have one core content model, a <code class=\"language-text\">ContentPage</code>, and then other models like <code class=\"language-text\">BodyText</code> and <code class=\"language-text\">SectionTitle</code> that could be stacked as children. A <code class=\"language-text\">ContentPage</code> would link to <code class=\"language-text\">BodyText</code> and <code class=\"language-text\">SectionTitle</code> via a <code class=\"language-text\">modules</code> field and have some other non-modular fields as well, like <code class=\"language-text\">slug</code> and <code class=\"language-text\">headline</code>.</p>\n<p>Here’s a <code class=\"language-text\">modules</code> field on a <code class=\"language-text\">ContentPage</code> currently in use on production:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/a6a89f283aa64891fff87f15f56bad06/29007/modules.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.513513513513516%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAA0UlEQVQY042RTU4EIRBGuf8V1I0TD6Jxogcw8QAuXNjd/DZVQBX4dY8LFzOT+VIJBHi8Cpg1c+997PkbbsiJMD9rXLzz3ocQnPOlVGyo9rMlopARFy61tmYmTpOzFlyIi7UxRVG9UitxykRlo43lbHdzjBF6Zr6kPRW0mRjmBvNMefEbCzVa16sRkX9tiymDtIRR42iRksc2XgO5xPfRYaWNFnP/Oj8ep8NxfniZPr4SKKrKDafOB+sQtP0ic/e8PL27w5vD5PObRXsgWYve8mG/7njRC/7svg0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"modules field\"\n        title=\"modules field\"\n        src=\"/gatsby-bloga-2/static/a6a89f283aa64891fff87f15f56bad06/fcda8/modules.png\"\n        srcset=\"/gatsby-bloga-2/static/a6a89f283aa64891fff87f15f56bad06/12f09/modules.png 148w,\n/gatsby-bloga-2/static/a6a89f283aa64891fff87f15f56bad06/e4a3f/modules.png 295w,\n/gatsby-bloga-2/static/a6a89f283aa64891fff87f15f56bad06/fcda8/modules.png 590w,\n/gatsby-bloga-2/static/a6a89f283aa64891fff87f15f56bad06/efc66/modules.png 885w,\n/gatsby-bloga-2/static/a6a89f283aa64891fff87f15f56bad06/c83ae/modules.png 1180w,\n/gatsby-bloga-2/static/a6a89f283aa64891fff87f15f56bad06/29007/modules.png 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Figuring out how to set this up in GraphQL took some trial and error, but we settled on using <a href=\"https://graphql.org/learn/queries/#inline-fragments\">inline fragments</a>.</p>\n<p>The GraphQL looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\">ContentfulContentPage <span class=\"token punctuation\">{</span>\n  headline\n  slug\n  modules <span class=\"token punctuation\">{</span>\n    __typename\n    <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">ContentfulBodyText</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\"># fields specific to BodyText</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span> <span class=\"token keyword\">on</span> <span class=\"token class-name\">ContentfulSectionTitle</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\"># fields specific to SectionTitle</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>After wiring up this new architecture, integrating new modules became a straightforward task.</p>\n<h4>Schema</h4>\n<p>We ran into one schematic limitation working with Gatsby that’s helpful to be aware of at the onset of your project:</p>\n<p><a href=\"https://github.com/graphql/graphql-js\">GraphQL</a> requires all queried fields to be defined in a schema, and Gatsby generates this schema from your site’s existing data. This means, for example, that if you don’t have a <code class=\"language-text\">Carousel</code> content model on your site right now, but you have a GraphQL query checking for it, the site will fail to build.</p>\n<p>The are some really promising discussions on the topic on GitHub, including an <a href=\"https://github.com/gatsbyjs/gatsby/issues/4261\">RFC to refactor Gatsby’s schema generation</a>, but in the meantime, most users are getting around this issue by creating placeholder content on Contentful (or whatever their data source is) to guarantee a fully built-up schema.</p>\n<p>This got the job done in our case, and we augmented the approach by creating a <code class=\"language-text\">DummyContentIndex</code> model on Contentful linking to all placeholder content. (In retrospect, I wish I had picked the a more PC name, like <code class=\"language-text\">PlaceholderContentIndex</code> 😉.) Using this approach, we could inform our Contentful scripts to make sure placeholder content was copied to the production environment during deploys, so that new models would not break the build.</p>\n<h3>Netlify</h3>\n<p>While we were getting familiar with our Gatsby/Contentful setup, we also needed to figure out how to build and deploy our work. We found several articles advocating for a Gatsby-Contentful-<a href=\"https://www.netlify.com/\">Netlify</a> stack, and learned it could support a workflow like this one:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/128fcc07ea64a86f88d5960efafafdb2/d0e73/netlify.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAACqElEQVQ4y5VUSVMaYRCd35dflZjcPKcqtxysHHIxiYAYQzAmJlpCYABlFRDZhmH2GfblpfsTDAxaald19Sxvevp7r7slrzeAoSmwDBWGacOybNi2A5OibpiYzWZgm8/nwvm5obWg6xphHViE1XQDaleD7biQTGeIn8F3OI+8x/FJDIeH37Af/orI9yMUS2VMptO7hGx5evZh+wV+HOwgEv2NcPgAuXyRvIRmsw3Joax/zuI4jyWRzRVwcZlDKp2hmEW90cJksp6w3mzhV3gXGTmBDGEzF1nUbhq4rtWhqhokPtISPB6P0ev1MRgM4Hke+v3+WjKOdxQs8I7jCLdtG6PRGBJWjAH8gt0wDEre20h4ezETKUeE1zTm0oJpmuJ7yXU9BEP7goubekOU32wpaLUVtJUOpj4OO502Dko3+FtTUatWxVEZx/zpJI5UrlSx9foNXr7awl4ghN1PX4QgheIVSlcV4nDyX2WKteskTkNvET+REQiFEAjuCxzzL0ThClOpDJJJmf6koqvp6Khd8Velo65VyN7VdRinJzALBaimBYVwosJWm9rOWueQP2DumOThcIiHbEClGiwEcec3aanc0l3XFclY5TmRPCXnXpxOZ4J07gCXWq1PggnMovKlS6s3q6bSsXfkFI5yRVymLxBPyKLRK9WaEG31VGsJN/pscc2cbEfP8DGWxnH0CJ/3gojFEyiSAKysv5Bl3OBw+YJ70DIsODS7DgnneT2wgJa4dxd4bJxMuo90P4i5NUms24VgPYi7N+FqldyDFk0Nb5I2NXqXIovi5+7JFY5GI8GXzH0qp2mSmjTfgwerezQhxzFVyUPP/ckz7t+PT0p4XwXMHTf8xqJ4ToXMIbdPLl+4248930p7dkKF5rtcriJfKKFBy/UxDv8BRDz3cPYwtCUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"our Netlify setup\"\n        title=\"our Netlify setup\"\n        src=\"/gatsby-bloga-2/static/128fcc07ea64a86f88d5960efafafdb2/fcda8/netlify.png\"\n        srcset=\"/gatsby-bloga-2/static/128fcc07ea64a86f88d5960efafafdb2/12f09/netlify.png 148w,\n/gatsby-bloga-2/static/128fcc07ea64a86f88d5960efafafdb2/e4a3f/netlify.png 295w,\n/gatsby-bloga-2/static/128fcc07ea64a86f88d5960efafafdb2/fcda8/netlify.png 590w,\n/gatsby-bloga-2/static/128fcc07ea64a86f88d5960efafafdb2/d0e73/netlify.png 671w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Unlike a single page app, which would fetch data from Contentful on the fly, our static site must rebuild anytime an editor publishes new or updated content. At the same time, we need to rebuild whenever code is updated on GitHub. With Netlify (and Contentful’s webhooks), I was able to set all of this up in about five minutes.</p>\n<p>Although our China setup was still a bit of a mystery, we moved forward with dev, QA, and staging environments on Netlify, and wound up using it for US production as well.</p>\n<p>Netlify exceeded our expectations; it solved our immediate workflow needs, and also automatically created builds for all remote branches and PRs. This is especially helpful at a company like ours where we often want to share WIP links with our design team to get feedback on our implementation.</p>\n<p>Gatsby’s <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-netlify\"><code class=\"language-text\">gatsby-plugin-netlify</code></a> also helped us out here with its <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-netlify#redirects\">redirect support</a>; any redirects we wrote using Gatsby’s <code class=\"language-text\">createRedirect</code> action were automatically deployed to Netlify’s <code class=\"language-text\">_redirects</code> file so they would function the same way during local development as they did on Netlify.</p>\n<h2>Creating a Gatsby workflow</h2>\n<h3>Dev pages</h3>\n<p>Building off of Gatsby’s Contentful example, we were able to easily support dynamic urls and one level of nesting, so a page with the slug <code class=\"language-text\">my-page</code> whose parent had the slug <code class=\"language-text\">my-parent</code> could have the path <code class=\"language-text\">/my-parent/my-page</code>.</p>\n<p>This worked so well that at first I was sure we wouldn’t even need to create any pages with static urls, but these wound up coming in handy for development and testing. We settled on a structure like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">|-pages/\n  |-dev/\n    |-article-components.js\n    |-home-components.js\n    |-validator.js</code></pre></div>\n<p>We used our static pages for three purposes:</p>\n<h4>1. Pre-integration QA</h4>\n<p>We dropped our stateless components into paths like <code class=\"language-text\">/dev/article-components</code> so our QA team could make a first pass on our UI implementation. Later, other team members would integrate these components into Contentful, where they could be tested against real data.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/710855596bcc7a97cf3222cfeca8933e/c367c/validator.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABl0lEQVQoz42RS04CQRCG5xS6MV4Fg4m3UC/BFVq3PO6CiUEXBGFg5WJ8kMCAsmEjDNPTM/0uq3uABTGRTv50pavyVf3VQfj4cBa9vpDxe3QXvX2QxWJBxuNPEk8n5Ovrm8znczKbTUkcO8UYx2SOmmI8mUy83HsURfftdvs8eO48VRndgBQcCpYCZwUIYWBNJWQ0BZblwBWAsQBgDQiMC6Hhr9PpdK6CQRhWMsbUz2olk2QtlsulXK3WUhuQSkk8SiptpbWltEFp42Nk7CSMMdDv96vBcDissCwDmiRuIsuFACkF5IzhLffd8zwHhm8C8wLdcM6BUgpKKT+7q/HAEIEFy0BmFLTgdgfQWoPripOgwMeHcjXWFWyBg8GgGozchK5zOY0tc6VK2L+yCPfcMAxLy85ekiQWbVmE+xvteuoxB+vM3vJoNKoUvLCbzcYg1KRpahBm0I5ra7bFx6i03Ov1LjgumeIOEeYXneEnudit4kjbfu/dbvcyqNVqJ61W67rZbN4eqtFo3Nbr9f39l3Y5ZNwg6/QXO9rD40cu1e0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"our content validator\"\n        title=\"our content validator\"\n        src=\"/gatsby-bloga-2/static/710855596bcc7a97cf3222cfeca8933e/fcda8/validator.png\"\n        srcset=\"/gatsby-bloga-2/static/710855596bcc7a97cf3222cfeca8933e/12f09/validator.png 148w,\n/gatsby-bloga-2/static/710855596bcc7a97cf3222cfeca8933e/e4a3f/validator.png 295w,\n/gatsby-bloga-2/static/710855596bcc7a97cf3222cfeca8933e/fcda8/validator.png 590w,\n/gatsby-bloga-2/static/710855596bcc7a97cf3222cfeca8933e/efc66/validator.png 885w,\n/gatsby-bloga-2/static/710855596bcc7a97cf3222cfeca8933e/c83ae/validator.png 1180w,\n/gatsby-bloga-2/static/710855596bcc7a97cf3222cfeca8933e/c367c/validator.png 1349w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4>2. Contentful validation</h4>\n<p>Contentful’s built-in validations could only take us so far, and sometimes we needed to enforce rules (or give recommendations) outside the scope of what Contentful could do. For example, when stacking modules on a page, we consider it a minor validation error for the page to end in a carousel (they look kind of lonely).</p>\n<p>To enforce such validations, we set up a static validator page that runs a report on all of our Contentful articles.</p>\n<h4>3. Communicating site status</h4>\n<p>That same validation page also served as a site status page, containing the time and GitHub hash of the last build. The build time was particularly important. Since builds happen quite frequently (whenever content is updated), it’s helpful for the team to be able to easily see the time of the last build for a given environment. (We also had Netlify integrated to Slack, but this contained notifications about every branch and was a bit noisy for a less tech-savvy audience.)</p>\n<p>Capturing this information was easy and only took a few additional lines in our <code class=\"language-text\">createPages</code> hook. Netlify exposes a lot of interesting <a href=\"https://www.netlify.com/docs/continuous-deployment/#build-environment-variables\">environment variables</a> (including some I hope to play with more on a future project, like <code class=\"language-text\">WEBHOOK_TITLE</code>, which can help you deduce the origin of the current build). In order to display these variables on the frontend, we needed to rename them to begin with <code class=\"language-text\">GATSBY_</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createPages</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span><span class=\"token string\">'COMMIT_REF'</span><span class=\"token punctuation\">,</span> ‘<span class=\"token constant\">BRANCH</span>’<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">variableName</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// only variables beginning with GATSBY_ are available client-side</span>\n    process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">[</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">GATSBY_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>variableName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">[</span>variableName<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After that, we just added one more variable to store the current time:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">GATSBY_BUILD_TIME</span> <span class=\"token operator\">=</span> Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4>Covering our tracks</h4>\n<p>We filtered out our dev pages in production by adding a simple <code class=\"language-text\">onCreatePage</code> hook to our <code class=\"language-text\">gatsby-node</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">exports<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onCreatePage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> boundActionCreators <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">GATSBY_ENV</span> <span class=\"token operator\">===</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">.</span><span class=\"token constant\">PRODUCTION</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> deletePage <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> boundActionCreators\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token regex\">/^\\/dev\\//</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token function\">deletePage</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Staging</h3>\n<p>A lot of our modules include many different properties coming together to form an intricate design, so it’s important to offer editors a chance to preview their changes before they’re published on production.</p>\n<h4>Contentful Preview API</h4>\n<p>We use Contentful’s Preview API, which <code class=\"language-text\">gatsby-source-contentful</code> <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-source-contentful#using-preview-api\">supports</a>, for this purpose. To set this up, we also needed to add a new webhook just for our <code class=\"language-text\">staging</code> branch on Netlify and wire this up on Contentful.</p>\n<h4>Generating preview links</h4>\n<p>Contentful’s <a href=\"https://www.contentful.com/r/knowledgebase/setup-content-preview/\">Content Preview</a> feature allows developers to expose preview links in the sidebar, so editors can easily move between editing an entry and previewing its content on a staging environment.</p>\n<p>Here’s how preview links look in action:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 345px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/8927f1dfbb6d9a068809594e75206837/e4d6b/preview-links.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 134.45945945945945%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAYAAAB836/YAAAACXBIWXMAAAsSAAALEgHS3X78AAAENElEQVRIx6VVS2tkVRDufyEMOG5c+AMGVIYRFBFdiIIIzh+ScRbixsdijC4mIOggRmdw4cLFiEkm6U7SdHq6O51+3Pf71fd9k8+qc293OkMYFC98VNV51Dl16qu6rSTLEcYJwkWCKEmR5sX/QitOM8iGA0kzoZg24jQHjy0IV8n4Spv20MX4ci32WlU58uoM5TmQliXiPEdalA0KJATWWSZ5Y5f1XEQOObIoTWuHQZzj8SDGeHiKQX8IXTVgmy40SYepWWTbsHQHBummbsOxfCGXdpbkOCvpMkVVhxwlGf6a29ifjfC4f4TOfIyeqWCP5J50in15giekM9pkH0hTdNU5dsdDoU9CB5OFC2nhibBbfprg9vgHvD7cwFvj+7g5+A7vjjZxe/oAn0we4AOa++j0R3w8+QnvnWzS/AZu0Zo3ht8LefP4Hm71N/D+001YSYSWm8R4rf0NXtj+FNd37uLa9h28svcF3jnawNtH3+LVztd48/AePuzdx43OV7i2cwfXd+/ixR3GZ3iJ5Mt7n+NG+0sYcYjWIsvwpz3GI7OP382BwEOjj1/0HraMHn4j/VfjGD9rXWxpPTzS+3i4Bra3aO0f5lAkppVS3JG3QOQuEDqRkIkfIyZETj3OQAmgQi2fRTMuksKpNj1fQHc8mH4AOwgFDB5zPTHO9OBonocVD4uyqlFVyIlfWVEjZ5Q1eF3SkPd5EDf0o1iUHkuugKs2/4fSyzEnMsu6hRmT2g/FxHpJ/VusQubwlpIH2ZG4WXPT+Jk6vuqgSyFblAjTC2At0dia5QrpBBElKRKJYt2iKKz19WJPWFcKnzg3KFzdxFyvpURdZzCVsN8bYKfTxe5BDx3S/253sU0YzRVIqz0NyOb3b2gTwHBr2gg0VOEx1XKgMOgQ1hk8pzVY38dPIRy6FIYXLrDgNhSnouHy9YVN4CiSxmad19RZzQU7LtGGF5zMZPRGUwwmssj2eK7SmIKZYojMn0oaVNOhN3UworUTWRcH8mFTWaN9EoZTmQ7M6izX5K1WhM6a7BbUdKnn4oyr6/xcoDxjUP+jObZ535IJqyxnRXHhrKFQRZt834csKTAMA7puwDBNWJaNMIpgkq4oGhzHBX9lVV04VAwbEoUqHpyowjq/T0bdgx3x5iAIBGzbQcw/tTAQc6wLh2W1XnoLkRiHeMbJcYhTXNthSHwzLQTES8/z4Lo12InjugjFAba4HUe0cijCXmsA/B70PMipgyiyAk2l0GijZVl0gIE0IUZE9WGqqq4cxsvSkw0T3cEYh/2RCNulW3aOh0TmIXr08+qdTOlZiLhZhZmZYm4lMPxMOOLEiUskzV+P61WzXaKKQnTQRBl59ASHdED7eISDp/SzIscnkko3KKgIEsh2TH2TuLiW3WTZbZatadkHl2GvmkZx0TzEuoL7Zy0vtbXm6f4BrWnhSRL45dEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"preview links in the Contentful sidebar\"\n        title=\"preview links in the Contentful sidebar\"\n        src=\"/gatsby-bloga-2/static/8927f1dfbb6d9a068809594e75206837/e4d6b/preview-links.png\"\n        srcset=\"/gatsby-bloga-2/static/8927f1dfbb6d9a068809594e75206837/12f09/preview-links.png 148w,\n/gatsby-bloga-2/static/8927f1dfbb6d9a068809594e75206837/e4a3f/preview-links.png 295w,\n/gatsby-bloga-2/static/8927f1dfbb6d9a068809594e75206837/e4d6b/preview-links.png 345w\"\n        sizes=\"(max-width: 345px) 100vw, 345px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The Content Preview dashboard lets developers create these links and determine where each of them will lead.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/bbc25fcf119649958d4ac85527c1851b/29007/content-preview-dashboard.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACeElEQVQoz52PzUsUYRzH5+DFQ7cOIbXjKbrkS2mQomlChFBoBZ26dBAS1mDwkiYU6O4eiiAIonNUZ/8Bgw133V3R3Xl1XUVRd2dmRx13Zuf9eX49o/aGRdEPPnx/z9vneR4q9Xa2sVzKRXe0zXFNUZk9TWM812G0qsoocoWpqjKjKr8SzoeoylHKcnl8fa0U/fTxQyM19piJpBYywEki5NgCLPMC8GIRWF4ETlgBQVoFXioeprhy1HNknT+muLYB65tbMJeah/sjDyPUWTpCt14dqLV13USt3Te885d6/Asd1/0rA3f99t7bJO/4Hf3D/uW+IZJDfjvJlr57fkvvsH+xa9Bv6bnldXYPorbOazXq1Gmaio6M0tnlvDXHLkFyPoPnkimcTGUxv7KGWXH1JFIJ86UtzK9u4vRiASdzS/hB8j3Evsxanyfe0FQ8nqBt17UcFIDn+ThACBDG8KcKVxzPBy9AYLk+GLaLi/4BbNkH1rvpl6EwTpumaZmGCa7rfjdhIv0ZRC4iDTiuB2VZhe2yTKiQXsG6pkNNr1mTz58dCev1ulUzjPAQ/p3sG2GFwo3tHdipyIeUKzKW1Spo+7o1MxOjqUQicfhCXdchCIK/Cl3y3e1dDeQqQVFDKTbqFtRtx3oyMUmE8RhtmHXTtu1wf0BAIURwgnCevBCRryKlqiFtbx+p2m6g1wyoEcfTqSmaev3qRfOBaePw5n+tqmeDhlzY95xQBJbjgmnZeHom1kxFo2NNoiCkOY4T8vl8gRRLkuV4npUkiRXFH4RjXhDZhdwim8pkCFk2nckWFrI5ocBx6Uejo00UqQbCGUKEcO4/iRw7Gr4CsBbW/Hq/aTgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Contentful&#39;s Content Preview dashboard\"\n        title=\"Contentful&#39;s Content Preview dashboard\"\n        src=\"/gatsby-bloga-2/static/bbc25fcf119649958d4ac85527c1851b/fcda8/content-preview-dashboard.png\"\n        srcset=\"/gatsby-bloga-2/static/bbc25fcf119649958d4ac85527c1851b/12f09/content-preview-dashboard.png 148w,\n/gatsby-bloga-2/static/bbc25fcf119649958d4ac85527c1851b/e4a3f/content-preview-dashboard.png 295w,\n/gatsby-bloga-2/static/bbc25fcf119649958d4ac85527c1851b/fcda8/content-preview-dashboard.png 590w,\n/gatsby-bloga-2/static/bbc25fcf119649958d4ac85527c1851b/efc66/content-preview-dashboard.png 885w,\n/gatsby-bloga-2/static/bbc25fcf119649958d4ac85527c1851b/c83ae/content-preview-dashboard.png 1180w,\n/gatsby-bloga-2/static/bbc25fcf119649958d4ac85527c1851b/29007/content-preview-dashboard.png 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Here, we’re configuring Contentful to expose a preview link for every <code class=\"language-text\">ContentPage</code> containing its Contentful ID in the path, so an entry with the ID <code class=\"language-text\">123</code> would have the URL <code class=\"language-text\">mystagingurl.com/en/123</code>. To support Chinese, we wired up an additional preview link in the format <code class=\"language-text\">mystagingurl.com/cn/123</code>.</p>\n<p><strong>Note:</strong> Contentful lets you generate preview links for as many model types as you like, but in our case, we only needed to generate preview URLs for our <code class=\"language-text\">ContentPage</code> model. Since all other models are displayed inside of <code class=\"language-text\">ContentPage</code>s, we determined that viewing a <code class=\"language-text\">BodyText</code> module all on its own would have no value.</p>\n<h4>Building staging URLs</h4>\n<p>Backing up a second, let’s review why we selected the preview URLs <code class=\"language-text\">mystagingurl.com/en/123</code> and <code class=\"language-text\">mystagingurl.com/cn/123</code>. Our staging environment — like all of our environments — already has all of the pages deployed at their actual paths (e.g. <code class=\"language-text\">/en/my-parent/my-parent</code>), so why can’t we just point editors there?</p>\n<p>Here’s why: Contentful’s Content Preview dashboard doesn’t give you that kind of flexibility. To get around this, we opted to build special paths just for the staging environment. Here’s how we set it up in <code class=\"language-text\">gatsby-node.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Always create a page at the regular path</span>\n<span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  component<span class=\"token operator\">:</span> contentPageTemplate<span class=\"token punctuation\">,</span>\n  context<span class=\"token punctuation\">,</span>\n  path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>language<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>slugs<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// On staging, recreate the page with a path corresponding to its ID</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">GATSBY_ENV</span> <span class=\"token operator\">===</span> <span class=\"token constant\">ENV</span><span class=\"token punctuation\">.</span><span class=\"token constant\">STAGING</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    component<span class=\"token operator\">:</span> contentPageTemplate<span class=\"token punctuation\">,</span>\n    context<span class=\"token punctuation\">,</span>\n    path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>language<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Build times</h4>\n<p>So now, we have Contentful’s preview links wired up to display the current entry in the staging environment, with data provided by the preview API. This is great, except that if an editor makes a change and immediately clicks on “Open preview” on Contentful, they’ll see old data — our static site is still building!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/4698ec160c655e633a274dc28464c0ec/10ab7/staging-environment.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACdElEQVQoz4WQ7U4TQRSGe0eEixGCJHIdJCZegD/WKE3UqNGApA1qYvCH0AJSClLbSEtrv3a3LS2lpbT70e7H7M7sHM8shWgkcZM37zlnzvvszkZyB6mZWrX4QlWa0Wq9EVWb7aiitqJq4wzVjjawF7PbeuqNZuf2rNk6X6nU1Jd7B4ezkdPs10WAHgBpAzFk8EwFXQF/rAIEOIcB6vJf5/1p35/WQ8gcf1mKlPPb9wJbgcCWPa3zwx+2vlPrMk/tYZF6ZpW6epkS1OTqlBKjQu1RKazNy0I4Z1bdp5O6B64KtUJyIVKvy3OIB8ZYYNsOd11X1EA9D6jvg4+9j7VPyLVPRSkNhbscPRCMuqzcR2B9Hu8GHrED17E4owRMfQjj0QBcewx6/xyIPQHjqgfOWAd7bIBlaODgbDQcCOe+54RAWZZvgBzf6ga2NeHWxIQhLhoYmmBYF2HHuu1D4Y6JvQDiPhfZO4EecTj1CTAqruiIGRCEiaCpa3gLJzy78WnNcfduIMK4pg3Dr3BdGwgGTVODbrcDg0EPxJlh6CFQ00YwNk381y737gKKYcAoT+wlIZ1LQ6acg3zlBJq9NrT6bSicVeDtxzVYXn4AsbVlePRwHj7EHgsOJ671F3AOQQLo4xfSbv+CpQppdlTJsppaZsVSlmUqP9m30jE7ymfYfmqT/TpJsNwxeinNMEuJa/vAA0DWQgSpi/DHQwMfihcydPUe/kcblFoeDqtZ6JgD+N+jKMpSJBaLzSSTiaeJ7S0pmdiWttBfxd5J6xvvpdU3z6WN9VXpyesV6dPmZym1n5J2dpKohLS7e+0iJ7STTDyLx+OzvwEjVFQP78ak8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Our staging environment\"\n        title=\"Our staging environment\"\n        src=\"/gatsby-bloga-2/static/4698ec160c655e633a274dc28464c0ec/fcda8/staging-environment.png\"\n        srcset=\"/gatsby-bloga-2/static/4698ec160c655e633a274dc28464c0ec/12f09/staging-environment.png 148w,\n/gatsby-bloga-2/static/4698ec160c655e633a274dc28464c0ec/e4a3f/staging-environment.png 295w,\n/gatsby-bloga-2/static/4698ec160c655e633a274dc28464c0ec/fcda8/staging-environment.png 590w,\n/gatsby-bloga-2/static/4698ec160c655e633a274dc28464c0ec/efc66/staging-environment.png 885w,\n/gatsby-bloga-2/static/4698ec160c655e633a274dc28464c0ec/c83ae/staging-environment.png 1180w,\n/gatsby-bloga-2/static/4698ec160c655e633a274dc28464c0ec/10ab7/staging-environment.png 1552w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>To solve this, we added a small overlay to all staging environment pages including the time of the last build, plus some code to automatically refresh the page every 30 seconds. When the page refreshes to reveal an updated build time, editors can click “Stop polling” to disable this functionality, and “Hide” to minimize the overlay.</p>\n<h4>Final thoughts</h4>\n<p>Our staging setup wasn’t perfect: Contentful’s Preview API felt a little clunky, and its “Discard Changes” button didn’t always work, with the “pending changes” status sometimes persisting… forever.</p>\n<p><img src=\"/gatsby-bloga-2/967dd66030554ce08bb09aa7a770d00b/contentful-pending-changes.gif\" alt=\"Contentful pending changes not disappearing\"></p>\n<p>For editors, it wasn’t always clear what was live and what wasn’t. On future projects, I hope to experiment with a similar approach using separate Contentful spaces, like we had for our dev and QA environments.</p>\n<h2>Contributing to Gatsby</h2>\n<p>Going into this project, I had one open source contribution to my name: an update to <a href=\"https://github.com/teampoltergeist/poltergeist\">poltergeist</a>’s key modifiers circa 2015. Sure, I felt a little guilty for using so many open source libraries without giving back to the community, but I also worried I didn’t have the time or — more importantly — the confidence to get more involved.</p>\n<p>Something clicked with Gatsby, though; it was young enough that I could see concrete areas for improvement, but established enough to have the tools and structure in place to facilitate contributions. Kyle and the rest of the community were also great resources, providing quick feedback and helpful ideas for improvements.</p>\n<h3>Starting small</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/ee481309ae887519c4903b22f22d654f/29007/worlds-smallest-pr.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsSAAALEgHS3X78AAAAiUlEQVQI10WLyw7CIBAA+/+/qDFa+mTZ8mihysKupDFxMoe5TEeAvEf3UnB7hhV2wAO3BPhW07nqgTTWcN/6B85D0FM08HHjG/pz8RK7krMw79bqeQUNKR61VrlgZirEwtZZMGgMpnSy/GjR5XER689Fb73yaspoxQdxlz5Qu0slqplKs8W/S/kCpzirYChbqYwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A very small pull request\"\n        title=\"A very small pull request\"\n        src=\"/gatsby-bloga-2/static/ee481309ae887519c4903b22f22d654f/fcda8/worlds-smallest-pr.png\"\n        srcset=\"/gatsby-bloga-2/static/ee481309ae887519c4903b22f22d654f/12f09/worlds-smallest-pr.png 148w,\n/gatsby-bloga-2/static/ee481309ae887519c4903b22f22d654f/e4a3f/worlds-smallest-pr.png 295w,\n/gatsby-bloga-2/static/ee481309ae887519c4903b22f22d654f/fcda8/worlds-smallest-pr.png 590w,\n/gatsby-bloga-2/static/ee481309ae887519c4903b22f22d654f/efc66/worlds-smallest-pr.png 885w,\n/gatsby-bloga-2/static/ee481309ae887519c4903b22f22d654f/c83ae/worlds-smallest-pr.png 1180w,\n/gatsby-bloga-2/static/ee481309ae887519c4903b22f22d654f/29007/worlds-smallest-pr.png 1600w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>If you’re nervous about contributing to a library, do what I did: make a really small change, and write a really long explanation about it :). <a href=\"https://github.com/gatsbyjs/gatsby/pull/2917\">My first Gatsby PR</a> removed three lines of code that I determined were overriding Contentful’s default image cropping. It was a low-pressure change that nevertheless helped me feel like part of the community.</p>\n<h3>Reading the documentation</h3>\n<p>We developers often take pride in how far we’re able to get <em>without</em> reading the documentation — at least I know I do — but, as I came to make subsequent PRs to Gatsby, I found the <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/CONTRIBUTING.md\">contributor guidelines</a> to be incredibly helpful.</p>\n<p>In particular, the documentation will show you how to use your local Gatsby clone and <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-dev-cli\">gatsby-dev-cli</a> to:</p>\n<ul>\n<li>Watch for your local changes to Gatsby packages</li>\n<li>Recompile packages on-the-fly</li>\n<li>Copy these packages into your project’s <code class=\"language-text\">node_modules</code> folder to test as you go</li>\n</ul>\n<p>If you’ve ever used <code class=\"language-text\">yarn link</code> to modify a dependency locally, this provides a similar experience.</p>\n<h3>Branching off</h3>\n<p>As I said, I was impressed by the Gatsby team’s quick turnaround time with PR approvals, but even so, when doing client work on a tight deadline, it can be stressful waiting for your changes to be merged. For ultimate peace of mind, you should be able to move forward using your forked work even if — in the worst case scenario — your PR is never approved.</p>\n<p>Of course, this is something developers do all the time. They push their fork to Git and link to it in their project’s <code class=\"language-text\">package.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">“dependencies”<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"some-library\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"git+ssh://git@github.com:workco/some-library.git#cool-feature\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Gatsby, however, uses a monorepo architecture, so pushing up a fork with a change to a specific package is not such a trivial manner; npm and yarn just don’t support it. (If you feel like being depressed, check out the npm thread about <a href=\"https://github.com/npm/npm/issues/2974\">supporting GitHub paths to monorepo packages</a>.)</p>\n<p>Our workaround was to create a new repo for the package in question and push the build directly to GitHub. Here’s how it would work if you were making an update to, say, <code class=\"language-text\">gatsby-source-contentful</code>:</p>\n<ul>\n<li>Go to your local fork of Gatsby, on the branch with your changes, and run <code class=\"language-text\">yarn watch</code> to compile a built version of your modified package.</li>\n<li>Copy that package to a new directory <code class=\"language-text\">cp -a packages/gatsby-source-contentful path-to-my-repo</code></li>\n<li>Push the contents of this directory to GitHub and link it in your <code class=\"language-text\">package.json</code> as usual.</li>\n</ul>\n<h2>Following up</h2>\n<p>Overall, our work with Gatsby was an exciting venture into a young, promising library, and I look forward to using it again on future Work &#x26; Co projects. I’m by no means an expert on Gatsby, Contentful, or Netlify — my goal is to share experiences others could draw insights from — so if you have any feedback or questions related to our approach, I’d love to hear from you <a href=\"mailto:mogin@work.co\">by email</a>.</p>","frontmatter":{"title":"Trying out Gatsby at Work & Co","date":"April 11, 2018","description":null}}},"pageContext":{"slug":"/docs/blog/2018-04-11-trying-out-gatsby-at-work-and-co/","previous":{"fields":{"slug":"/docs/blog/2018-04-10-how-to-handle-comments-in-gatsby-blogs/"},"frontmatter":{"title":"How to handle comments in Gatsby blogs"}},"next":{"fields":{"slug":"/docs/blog/2018-04-25-how-gatsby-changes-teams-website-development-workflow/"},"frontmatter":{"title":"How Gatsby Changes Teams' Website Development Workflow"}}}}}