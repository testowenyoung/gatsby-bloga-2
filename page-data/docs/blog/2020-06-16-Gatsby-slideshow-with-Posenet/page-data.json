{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2020-06-16-Gatsby-slideshow-with-Posenet/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"7d4e183b-c056-5549-a899-3f2e2e097a70","excerpt":"The Problem I’ve been social distancing for a while now and I’m working from home full time. I live in an old building with unreliable internet but, using a LAN…","html":"<h2>The Problem</h2>\n<p><a href=\"https://sld.codes/articles/A-Social-Distancing-Infographic-Poster\">I’ve been social distancing for a while now</a> and I’m working from home full time. I live in an old building with unreliable internet but, using a LAN cable, I get by most of the time. I disable my video and avoid sharing my screen wherever possible. However what happens when I need to present something to my team? Well, then my colleagues get a pixelated presentation and the occasional drop from their host.</p>\n<p>The UX designer in me thinks this is less than ideal. I spend considerable time putting presentations together and they deserve a proper delivery. <strong>I started to wonder if there was a better way to deliver slide decks — one that didn’t involve sharing my screen.</strong></p>\n<h2>The Current Work Flow</h2>\n<p>PowerPoint and me are not friends. My slide decks are normally minimalist. They feature a title, an image, some code or an emoji per slide and that’s about it. Almost always these elements are centered in the middle of the slide and when working in PowerPoint, I would find myself spending most of my time scaling images to fit the slide.</p>\n<p>Whilst building out <a href=\"https://sld.codes/\">my personal website</a> last year in <a href=\"https://www.gatsbyjs.org/\">Gatsby</a>, I came across <a href=\"https://www.npmjs.com/package/gatsby-theme-mdx-deck\"><code class=\"language-text\">gatsby-theme-mdx-deck</code></a>. As its name suggests, this theme takes MDX and turns it into slide decks — it was the PowerPoint alternative I was looking for.</p>\n<h3>An Example Using <code class=\"language-text\">gatsby-theme-mdx-deck</code></h3>\n<p>The first step is to add <code class=\"language-text\">gatsby-theme-mdx-deck</code> to your gatsby config:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript:title=gatsby-config.js\"><pre class=\"language-javascript:title=gatsby-config.js\"><code class=\"language-javascript:title=gatsby-config.js\">{\n  resolve: `gatsby-theme-mdx-deck`,\n  options: {\n    contentPath: `MDX/Decks`,\n    basePath: `/decks`,\n  },\n}</code></pre></div>\n<p>The plugin expects a location where your MDX files are located and a basepath on where your decks should be found on your site.</p>\n<p>In the folder I specified as the content path, I create a new <code class=\"language-text\">.mdx</code> file and add the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"mdx:title=mdx/decks/sitedesign/slides.mdx\"><pre class=\"language-mdx:title=mdx/decks/sitedesign/slides.mdx\"><code class=\"language-mdx:title=mdx/decks/sitedesign/slides.mdx\">---\ntitle: &quot;Portfolio 101&quot;\ndesc: How I built this site and how you can design, build and host your own.\ndate: 2020-05-10\nlocation: Space | Earth\n---\n\n# Portfolio 101\n\n## How I built this site and how you can design, build and host your own.\n\nThis is all...\n\n# IMO\n\n---\n\nYour site is your space on the net.\n(Do what you want with it.)</code></pre></div>\n<p>You’ll see at the top of the file I have frontmatter that acts much like meta data, I query this data to show you information about the presentation you are about to open. The theme reads three dashes in a row as a signal to split the document and create a new slide. The above code outputs the following three slides when run:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/8fb63e389e6da3dbfcdf74021a4c6561/2bef9/slide-previews.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABs0lEQVQoz2WQz0vTcRzGv1jfheLskvMbqOy7giy9aC6ohMJQxEGkBKlgTtDt4HbaJDdL0ATb2igrD9NT/QtREIRUhkw9eGrKrJs6D7vqwR+fV5/Pdxdxb3jg4Xk/74eHt3apthGH8yaGy41xReLqLcmbqTILMBTqbhdgntKlx/KqG5dbqAyZJTSHswm70cD5Mie2a25s99vRL9RSWllHmeMGuq0GveUB+r02dL3G0korr0tejd7hwdZ4V/mFypBZQrMb9bR6+hifiBN+mWA0+Z7I81d4/WGePA0QnYgRmowTmnpN9EWMHm+QAbmLjM8QTr4jNJ2QtzHR/rBfFqsXWkm5SXJ2ATXHh4dwdGzxzew/Fn8uc3Z+/V7hTyZ7VhYfUh8psZtCO1fhYmpmloODfTIbG2S3/pLP50mvrvP563fLvb29Qy63Z/Ev3xZJr60jxAk7u7vk9ixdJN7OI7NkQ7tJ/E2qqIlq+GMpXaQvLa+R2dwqajiX+lRoePFyA3dau/EHowz4Qnglhkae0dXrp7PLiy8QYVD+TGE4MIane5BHPT6GR8YsTf3aF4yIlrbHyCzxHyHsWn0PdQZ2AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Three numbered presentation slides\"\n        title=\"Three numbered presentation slides\"\n        src=\"/gatsby-bloga-2/static/8fb63e389e6da3dbfcdf74021a4c6561/fcda8/slide-previews.png\"\n        srcset=\"/gatsby-bloga-2/static/8fb63e389e6da3dbfcdf74021a4c6561/12f09/slide-previews.png 148w,\n/gatsby-bloga-2/static/8fb63e389e6da3dbfcdf74021a4c6561/e4a3f/slide-previews.png 295w,\n/gatsby-bloga-2/static/8fb63e389e6da3dbfcdf74021a4c6561/fcda8/slide-previews.png 590w,\n/gatsby-bloga-2/static/8fb63e389e6da3dbfcdf74021a4c6561/efc66/slide-previews.png 885w,\n/gatsby-bloga-2/static/8fb63e389e6da3dbfcdf74021a4c6561/2bef9/slide-previews.png 1024w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>That was easy! I can then navigate to <code class=\"language-text\">/decks</code> and surf through these slides using my arrow keys.</p>\n<p>Another cool part to this is that your slides are hosted on a website. You can give anyone the URL and they can recap your slides at a later date. This method is how I built <a href=\"https://sld.codes/presentations\">version one of my presentations page</a>.</p>\n<h3>My Light Bulb Moment</h3>\n<p><em>This was when I had a sudden idea: When I give a presentation, my slide decks are already hosted. Why don’t I just send people to the URL and let them “follow along” as I present?</em></p>\n<p>This takes the pressure off my bandwidth and instead pushes it off to each individual client. Yes, it means they have to download the slide assets, but this load is far smaller than streaming video — everyone wins. It also gives me the ability to add far more interactive elements to my slides to keep interest from viewers.</p>\n<h2>Modifying <code class=\"language-text\">gatsby-theme-mdx-deck</code></h2>\n<p>In order to start working on this library I moved it from my <code class=\"language-text\">node-modules</code> folder into a folder called <code class=\"language-text\">plugins</code>. Gatsby knows that this folder contains any local versions of plugins that I am working on.</p>\n<h3>Improving The UX</h3>\n<p>The first thing I wanted to do was make the way in which you interact with the slide decks more obvious. When you navigate to a slide deck there are no instructions and no interact-able elements. I decided that I should add the following buttons:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/af56e90cffa9f1c53509570eded608fb/2bef9/button-previews.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABBUlEQVQoz22RT2+CQBDFPTcmin8wqcoumKgtpSCC0Vqqiakc2ouXXvvR+k33dXYEwdXD5M2+nf3NMDT6IoaOnrNgtY1zqf07/qDyFKtYqEa9qEvaciLWum+RtinMJg/jkO8oV706sISNxBLZZAshE3SKR1rn7gqxt+bpGeZQPeWn2R5TurPMCUugIOBRvsETZ6BdTBeKFJmsgFqbjwH+5l/YyQ2aTqRsE8g78VLE228Mp2t0x9G5EeksPuBllXPOTYavCOicn37hp0d0RuHthNxZLjEJdhi4SbVXgrjP7/D87OIRAH7yiY/8B0/U7AZYX7ZFxebyNUDH1Y+iKdv02YWvtK+B/1Yix72gvxqeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Help, Close and Toggle Follow Icons\"\n        title=\"Help, Close and Toggle Follow Icons\"\n        src=\"/gatsby-bloga-2/static/af56e90cffa9f1c53509570eded608fb/fcda8/button-previews.png\"\n        srcset=\"/gatsby-bloga-2/static/af56e90cffa9f1c53509570eded608fb/12f09/button-previews.png 148w,\n/gatsby-bloga-2/static/af56e90cffa9f1c53509570eded608fb/e4a3f/button-previews.png 295w,\n/gatsby-bloga-2/static/af56e90cffa9f1c53509570eded608fb/fcda8/button-previews.png 590w,\n/gatsby-bloga-2/static/af56e90cffa9f1c53509570eded608fb/efc66/button-previews.png 885w,\n/gatsby-bloga-2/static/af56e90cffa9f1c53509570eded608fb/2bef9/button-previews.png 1024w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Note that the toggle button will only be present when I am presenting a talk. When I am not, you get control of the slides!</p>\n<p>In the situations when I am not around to give you the tour of how these buttons work, I thought I would let <a href=\"https://www.npmjs.com/package/react-joyride\"><code class=\"language-text\">react-joyride</code></a> do it for me. I decided to use a cookie to determine whether the user had seen the tour before. I would only trigger the tour if that cookie had not been set:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript:title=plugins/gatsby-theme-mdx-deck/src/components/tour.js\"><pre class=\"language-javascript:title=plugins/gatsby-theme-mdx-deck/src/components/tour.js\"><code class=\"language-javascript:title=plugins/gatsby-theme-mdx-deck/src/components/tour.js\">export default () =&gt; {\n  const [cookies, setCookie] = useCookies()\n  const TourActive = !cookies.SLDPresTourCookie\n  const tourCB = e =&gt; {\n    if (e.action === &quot;reset&quot; || e.action === &quot;close&quot;) {\n      setCookie(&quot;SLDPresTourCookie&quot;, true)\n    }\n  }\n  return (\n    &lt;Joyride\n      steps={toursteps}\n      run={TourActive}\n      showSkipButton={true}\n      continuous={true}\n      callback={tourCB}\n      showProgress={true}\n      disableCloseOnEsc={true}\n      disableOverlayClose={true}\n    /&gt;\n  )\n}</code></pre></div>\n<p>The result:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/683e28447461e94bdbf9745d99042a59/2bef9/tour-preview.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABQElEQVQoz42Ru0uCURiH/RuyqMwyLKExK4uCkkjHSAgSLMuGLn9Cq+iSaTfQqKYuU2AXG4K8kU1NXfRrChqkhhArI0gtn760IKLhO/Bw3uE9z3t+58gqVC38prxOS5W6ja7efvTGAXr6RAzfiLXeaKLbYKK6QYdc7C2eUWkLP7vsr1Be20yNpp2NzS1OYydEwiGikXCRSChILBrB611Bqeko9koQasXpbZxfJsjm33lIpUmln3h8zpDKvFAAdg8OqawvpZEmFCNfxa/5Wm/ZHDlRnH//4PU2CcIN+zt+KtWt0oWKRh3+vQDJ+zsEQSgRT3AROCK+vs3asg+F9MilN3TaHZwdB5n3eJhzzeJ2u3AvLbC46sPudKJq6qRMKUH488tD5nGcMw6stmkso5MMj01hsU4wItaDZpuYov3fG34CrRsZPj9bHoAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Modal highlighting the toggle follow button\"\n        title=\"Modal highlighting the toggle follow button\"\n        src=\"/gatsby-bloga-2/static/683e28447461e94bdbf9745d99042a59/fcda8/tour-preview.png\"\n        srcset=\"/gatsby-bloga-2/static/683e28447461e94bdbf9745d99042a59/12f09/tour-preview.png 148w,\n/gatsby-bloga-2/static/683e28447461e94bdbf9745d99042a59/e4a3f/tour-preview.png 295w,\n/gatsby-bloga-2/static/683e28447461e94bdbf9745d99042a59/fcda8/tour-preview.png 590w,\n/gatsby-bloga-2/static/683e28447461e94bdbf9745d99042a59/efc66/tour-preview.png 885w,\n/gatsby-bloga-2/static/683e28447461e94bdbf9745d99042a59/2bef9/tour-preview.png 1024w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>I tried to keep the instructions short and sharp. You can check it out by <a href=\"https://sld.codes/decks/HOWTOGATSBY/slides/0\">checking out one of my presentations</a>.</p>\n<h3>Creating The “Follow Me” Feature</h3>\n<p>In order to get this to work I was going to need two new features — an internal state to monitor the position in the slides for viewers and a way of sending realtime updates from my machine. A Redux + Socket.IO combination would do nicely.</p>\n<p>Up to this point my personal website had been entirely static. I had had no need to introduce internal state on any other page so I consulted the <a href=\"/gatsby-bloga-2/docs/adding-redux-store/\">Gatsby docs</a> on the subject. That combined with this <a href=\"https://github.com/itaylor/redux-socket.io\">awesome repo</a> on Redux and Socket.IO combined, gave me all the pieces I needed to create the feature — I just had to bring them together.</p>\n<h4>Creating The Server</h4>\n<p>I spun up a Node.js server on and added the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript:title=app.js\"><pre class=\"language-javascript:title=app.js\"><code class=\"language-javascript:title=app.js\">io.on(&quot;connection&quot;, function (socket) {\n  if (active) {\n    //If there is a presentation already started, tell the user.\n    socket.emit(&quot;action&quot;, {\n      type: &quot;startLivePresentor&quot;,\n      data: pres,\n    })\n  }\n  socket.on(&quot;action&quot;, action =&gt; {\n    if (action.type === &quot;server/verify&quot;) {\n      // When I want to initiate a presentation, I send this action and verify it is myself with the password.\n      if (process.env.PRESENT_PASSWORD === action.data.password) {\n        pres.presenter = socket.id\n        active = true\n        pres.deck = action.data.location\n        pres.slide = action.data.index\n        //I tell any connected clients that I have started the presentation.\n        io.emit(&quot;action&quot;, {\n          type: &quot;startLivePresentor&quot;,\n          data: pres,\n        })\n      }\n    }\n    if (action.type === &quot;server/updateIndex&quot;) {\n      if (socket.id === pres.presenter) {\n        // When I (the presenter), update the other clients so they can also update their slides\n        pres.slide = action.data\n        io.emit(&quot;action&quot;, {\n          type: &quot;updatePresIndex&quot;,\n          data: pres,\n        })\n      }\n    }\n    if (action.type === &quot;server/endPres&quot;) {\n      if (socket.id === pres.presenter) {\n        // When I (the presenter) end the presentation, notify viewers\n        io.emit(&quot;action&quot;, {\n          type: &quot;endLivePresentor&quot;,\n        })\n        active = false\n        pres = defaultPres\n      }\n    }\n  })\n  socket.on(&quot;disconnect&quot;, function () {\n    if (socket.id === pres.presenter) {\n      // When I (the presenter) get disconnected, end the presentation and notify viewers\n      io.emit(&quot;action&quot;, {\n        type: &quot;endLivePresentor&quot;,\n      })\n      active = false\n      pres = defaultPres\n    }\n  })\n})</code></pre></div>\n<h2>Implementing Redux On The Site</h2>\n<p>First we need to add a custom wrapper around Gatsby:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript:title=gatsby-browser.js\"><pre class=\"language-javascript:title=gatsby-browser.js\"><code class=\"language-javascript:title=gatsby-browser.js\">import wrapWithProvider from &quot;./src/state/wrapWithProvider&quot;\nexport const wrapRootElement = wrapWithProvider</code></pre></div>\n<p>This wrapper needs to wrap our site content in a Redux provider.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx:title=src/state/wrapwithprovider.js\"><pre class=\"language-jsx:title=src/state/wrapwithprovider.js\"><code class=\"language-jsx:title=src/state/wrapwithprovider.js\">import React from &quot;react&quot;\nimport { Provider } from &quot;react-redux&quot;\nimport createStore from &quot;./createStore&quot;\nexport default ({ element }) =&gt; {\n  return &lt;Provider store={createStore}&gt;{element}&lt;/Provider&gt;\n}</code></pre></div>\n<p>In our store we add methods to handle any incoming actions from the server. Notice the <code class=\"language-text\">socketIoMiddleware</code> that catches any actions that start with <code class=\"language-text\">/server</code> and emits them to our server.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript:title=src/state/createstore.js\"><pre class=\"language-javascript:title=src/state/createstore.js\"><code class=\"language-javascript:title=src/state/createstore.js\">import { createStore, applyMiddleware } from &quot;redux&quot;\nimport createSocketIoMiddleware from &quot;redux-socket.io&quot;\nimport io from &quot;socket.io-client&quot;\nlet socket = io(&quot;http://your-socket-server-here.com&quot;)\nlet socketIoMiddleware = createSocketIoMiddleware(socket, &quot;server/&quot;)\nfunction reducer(\n  state = {\n    livePresenter: false,\n    follow: true,\n    verified: false,\n  },\n  action\n) {\n  switch (action.type) {\n    case &quot;follow&quot;:\n      return Object.assign({}, { ...state, follow: action.data })\n    case &quot;verify&quot;:\n      return Object.assign({}, { ...state, verified: action.data })\n    case &quot;updatePresIndex&quot;: {\n      return Object.assign({}, { ...state, presentation: action.data })\n    }\n    case &quot;startLivePresentor&quot;:\n      return Object.assign(\n        {},\n        { ...state, livePresenter: true, presentation: action.data }\n      )\n    case &quot;endLivePresentor&quot;:\n      return Object.assign(\n        {},\n        {\n          ...state,\n          livePresenter: false,\n          presentation: undefined,\n          verified: false,\n        }\n      )\n    default:\n      return state\n  }\n}\nlet store = applyMiddleware(socketIoMiddleware)(createStore)(reducer)\nstore.subscribe(() =&gt; {\n  console.log(&quot;new client state&quot;, store.getState())\n})\nexport default store</code></pre></div>\n<p>Now if we connect any component using Redux we will have access to these values.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript:title=plugins/gatsby-theme-mdx-deck/src/components/deck.js\"><pre class=\"language-javascript:title=plugins/gatsby-theme-mdx-deck/src/components/deck.js\"><code class=\"language-javascript:title=plugins/gatsby-theme-mdx-deck/src/components/deck.js\">const Deck = ({\n  follow,\n  presentation,\n  livePresenter,\n  changePresPosOnServer,\n  verified,\n}) =&gt; {\n  /* ... */\n  /*\n  If their is a live presenter and:\n  A. You ARE NOT the one presenting\n  B, You are in the same deck as the one being presented\n  C. You have follow turned on.\n  Then: Jump to the slide that the live presenter is on\n  */\n  if (\n    !verified &amp;&amp;\n    livePresenter &amp;&amp;\n    follow &amp;&amp;\n    presentation &amp;&amp;\n    window.location.pathname.includes(presentation.deck) &amp;&amp;\n    window.location.pathname !==\n      presentation.deck + &quot;/slides/&quot; + presentation.slide\n  ) {\n    jump(slug, presentation.slide)\n  }\n  /*\n  If their is a live presenter and:\n  A. You ARE the one presenting\n  B. The slide you are on does not match the index on the server\n  Then: Emit action the server telling the viewers where you are\n  */\n  if (\n    verified &amp;&amp;\n    presentation &amp;&amp;\n    window.location.pathname !== &quot;/presentations/&quot; &amp;&amp;\n    index !== presentation.slide\n  ) {\n    changePresPosOnServer(index)\n  }\n  return &lt;&gt;{/* Slides rendered here */}&lt;/&gt;\n}\nconst mapStateToProps = ({ presentation, follow, livePresenter, verified }) =&gt; {\n  return { presentation, follow, livePresenter, verified }\n}\nconst mapDispatchToProps = dispatch =&gt; {\n  return {\n    changePresPosOnServer: value =&gt;\n      dispatch({ type: &quot;server/updateIndex&quot;, data: value }),\n  }\n}\nconst ConnectedDeck =\n  typeof window !== `undefined`\n    ? connect(mapStateToProps, mapDispatchToProps)(Deck)\n    : Deck\nexport default ConnectedDeck</code></pre></div>\n<p>And just like that we can now control slide decks remotely!</p>\n<p><img src=\"/gatsby-bloga-2/87f966eaac692816ad8f2a155ea33955/remote-slides.gif\" alt=\"A sample slide deck being presented and viewed in parallel\"></p>\n<h2>Get The Code:</h2>\n<p><a href=\"https://github.com/slarsendisney/personal-site\">Personal Site Repo</a></p>\n<p><a href=\"https://github.com/slarsendisney/sld-clicker\">Socket Server</a></p>\n<h2>Extension: Gesture Controlling My Slides</h2>\n<p><a href=\"https://sld.codes/articles/My-learnings-from-HalfStacks-Conference\">I recently attended a conference called “HalfStack”</a>. While I was there I saw a demo of <a href=\"https://www.npmjs.com/package/@tensorflow-models/posenet\">PoseNet</a>. An awesome library that uses a model to identify key body parts from an image or video. I thought it would be cool to use this library to create touch-free slide navigation for presenters using just their gestures.</p>\n<h3>How PoseNet Works</h3>\n<p>PoseNet uses a trained model to take an image and make an attempt at guessing the location of key body parts in that photo. You can see how, in the preview below, the skeleton is very closely matching my actual position — I was super impressed with its accuracy.</p>\n<p><img src=\"/gatsby-bloga-2/0c3760444f4d7fde123cccfccf297cb7/gesture-control.gif\" alt=\"Man gesturing with two hands to the right and left to move slides forward and backward respectively\"></p>\n<p>Being a magician! 🎩</p>\n<p>It can be implemented relatively easily (code borrowed from <a href=\"https://github.com/kirstenlindsmith/PoseNet_React/blob/master/client/components/Camera.js\">Kirsten Lindsmith’s “PoseNet for React” repo on GitHub</a>):</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">PoseNet</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">async</span> <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>posenet <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> posenet<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"PoseNet failed to load\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> loading<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">loadComplete</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">detectPose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">detectPose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> videoWidth<span class=\"token punctuation\">,</span> videoHeight <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props\n    <span class=\"token keyword\">const</span> canvas <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>canvas\n    <span class=\"token keyword\">const</span> canvasContext <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span>\n    canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> videoWidth\n    canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> videoHeight\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">poseDetectionFrame</span><span class=\"token punctuation\">(</span>canvasContext<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">poseDetectionFrame</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">canvasContext</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> posenetModel <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>posenet\n    <span class=\"token keyword\">const</span> video <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>video\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">findPoseDetectionFrame</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">let</span> poses <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">const</span> pose <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> posenetModel<span class=\"token punctuation\">.</span><span class=\"token function\">estimateSinglePose</span><span class=\"token punctuation\">(</span>video<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        imageScaleFactor<span class=\"token punctuation\">,</span>\n        flipHorizontal<span class=\"token punctuation\">,</span>\n        outputStride<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      poses<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>pose<span class=\"token punctuation\">)</span>\n      canvasContext<span class=\"token punctuation\">.</span><span class=\"token function\">clearRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> videoWidth<span class=\"token punctuation\">,</span> videoHeight<span class=\"token punctuation\">)</span>\n      poses<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> score<span class=\"token punctuation\">,</span> keypoints <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>score <span class=\"token operator\">>=</span> minPoseConfidence<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>props<span class=\"token punctuation\">.</span><span class=\"token function\">poseCB</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> keypoints <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>showSkeleton<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">drawSkeleton</span><span class=\"token punctuation\">(</span>\n              keypoints<span class=\"token punctuation\">,</span>\n              minPartConfidence<span class=\"token punctuation\">,</span>\n              skeletonColor<span class=\"token punctuation\">,</span>\n              skeletonLineWidth<span class=\"token punctuation\">,</span>\n              canvasContext\n            <span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token function\">requestAnimationFrame</span><span class=\"token punctuation\">(</span>findPoseDetectionFrame<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">findPoseDetectionFrame</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>video</span>\n          <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>videoNoShow<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>border-radius<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> display<span class=\"token operator\">:</span> <span class=\"token string\">\"none\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">playsInline</span>\n          <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>getVideo<span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>canvas</span>\n          <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>webcam is-blue-bg border-radius<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>getCanvas<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> width<span class=\"token operator\">:</span> <span class=\"token string\">\"100%\"</span><span class=\"token punctuation\">,</span> height<span class=\"token operator\">:</span> <span class=\"token string\">\"100%\"</span><span class=\"token punctuation\">,</span> margin<span class=\"token operator\">:</span> <span class=\"token string\">\"auto\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> PoseNet</code></pre></div>\n<h3>Using This Data</h3>\n<p>Now what this gives us access to is an array of keypoints. Each point represents a body part, PoseNet’s estimate of where that body part is and its confidence score.</p>\n<p>For my purposes, I focused on the wrists. When gesturing right or left, both wrists are close together and in a specific portion of the screen.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/34286573e82426dc2813df5f2bafae1e/2bef9/gesture-ranges.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAACVElEQVQoz4VS20+SYRz2NssDhwIMMO1gnD8+QDQ0IFBbXGCWOKaYFh5mGCybgI1EgZRFdeHUbDPtKtZFra2LbrrILWurrbWWra1pW/9Dq+3rfXo/RrW2lhfP3sPv9zzv83v2luyuZsFDpDSiqsYMK+OERWcHq7dDwzqhM7vAWFuhMjqgYewwqm1gKdR1jRBTTpFP+JWev5Xwmz0UZXv1MOsd2JrK4v3FBNaiCdy/u4T52SlEh3px62YKK5kknp4N4Xn/COa83RD+X9AAVtuMjfEk3l2YwJvpWTxcvob8jUlc6nBjMuRDfiaOtWAYrwfCWOgIQKjY1qEdX9LX8SmWwubcEp7cW8SD5UUMek9i1OfBy/xtrI+M421oHHf8QQgUzPaCm1dmsBFJ4EM2h5W5DGJ9A+j3+OGyNmE1HcOrcLwguBoYhkBu+LegZJ8J5bRYb3Dgc3Qam/EUXozFMBHoQqTTB2mZFDKhCOmgHx8vZ7CVyiHfdx4i3gzl/haspoKVVXpUynTYIdHg8H4LHkUmsJ6bx0LvEA5W18GqtqJipwSlpQJ0Ou14PJbAs2QWV7092CXVokKmhVBu+ONQxbqI8cgJoqtvIyqTmxxt6yKMzUOECoZIa82k+DqFidARiVJlI42OdtJ4rINoLa2Epb01mmYionkWHBoajsPqaIe/bxSnuoehMbdAzBfplxAr2V8ZoegA8kMNUJta0HMugjODY2hyn8YBmn1R8Ds/Mlcu1XKSGjNHLzk6AkfJBVCBv8Df8T0iOcPJai0cza/ApSPztR+05+tPEK1nK2ltiPAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Man gesturing both hands into a highlighted red portion of the screen to the left\"\n        title=\"Man gesturing both hands into a highlighted red portion of the screen to the left\"\n        src=\"/gatsby-bloga-2/static/34286573e82426dc2813df5f2bafae1e/fcda8/gesture-ranges.png\"\n        srcset=\"/gatsby-bloga-2/static/34286573e82426dc2813df5f2bafae1e/12f09/gesture-ranges.png 148w,\n/gatsby-bloga-2/static/34286573e82426dc2813df5f2bafae1e/e4a3f/gesture-ranges.png 295w,\n/gatsby-bloga-2/static/34286573e82426dc2813df5f2bafae1e/fcda8/gesture-ranges.png 590w,\n/gatsby-bloga-2/static/34286573e82426dc2813df5f2bafae1e/efc66/gesture-ranges.png 885w,\n/gatsby-bloga-2/static/34286573e82426dc2813df5f2bafae1e/2bef9/gesture-ranges.png 1024w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>When both wrists were in the same box, I knew I was gesturing for a slide change.</p>\n<p>All that was left was to work out whether my poses array containing the positions of the left and right wrist had placed them both in the bounding box. I could then use my socket connection as above to change the slide.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>presentation <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">differenceInSeconds</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> lastPunch<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> gesturingRight <span class=\"token operator\">=</span> poses<span class=\"token punctuation\">.</span><span class=\"token function\">every</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>x <span class=\"token operator\">></span> window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">*</span> <span class=\"token number\">0.75</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> gesturingLeft <span class=\"token operator\">=</span> poses<span class=\"token punctuation\">.</span><span class=\"token function\">every</span><span class=\"token punctuation\">(</span>\n      <span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">.</span>x <span class=\"token operator\">&lt;</span> window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">*</span> <span class=\"token number\">0.25</span>\n    <span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>gesturingRight <span class=\"token operator\">&amp;&amp;</span> presentation<span class=\"token punctuation\">.</span>slide <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">changePresPosOnServer</span><span class=\"token punctuation\">(</span>presentation<span class=\"token punctuation\">.</span>slide <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>gesturingLeft <span class=\"token operator\">&amp;&amp;</span> presentation<span class=\"token punctuation\">.</span>slide <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">changePresPosOnServer</span><span class=\"token punctuation\">(</span>presentation<span class=\"token punctuation\">.</span>slide <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">setLastPunch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>poses<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>That’s all Folks!</h2>\n<p>I hope you have enjoyed this little experiment. If you have questions or want to join me on some of my other adventures you can find me at <a href=\"https://sld.codes/\">sld.codes</a>.</p>","frontmatter":{"title":"Presenting Without Sharing My Screen","date":"June 16, 2020","description":null}}},"pageContext":{"slug":"/docs/blog/2020-06-16-Gatsby-slideshow-with-Posenet/","previous":{"fields":{"slug":"/docs/blog/2020-06-11-you-belong-here-commitment/"},"frontmatter":{"title":"You Belong Here"}},"next":{"fields":{"slug":"/docs/blog/2020-06-18-Gatsby-cli-survey-2/"},"frontmatter":{"title":"Gatsby CLI Survey 2 Results Are In!"}}}}}