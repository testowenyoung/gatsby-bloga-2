{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2018-06-08-life-after-layouts/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"ee2467c8-fb18-5801-98c5-386ad7d84e2e","excerpt":"So the Gatsby V2 beta is out, and Gatsby’s layout components are going away. What does this mean for your projects? This article will dive into the Gatsby V2’s…","html":"<p>So the Gatsby V2 beta is out, and Gatsby’s <a href=\"https://github.com/gatsbyjs/rfcs/blob/master/text/0002-remove-special-layout-components.md\">layout components are going away</a>. What does this mean for your projects?</p>\n<p>This article will dive into the Gatsby V2’s approach to layouts, talk about what changed and why, and walk through the migration process to get your existing projects updated to V2.</p>\n<p>If you still need the v1 layout behavior, checkout <a href=\"/gatsby-bloga-2/packages/gatsby-plugin-layout/\">gatsby-plugin-layout</a>.</p>\n<h2>What changed?</h2>\n<p>In Gatsby V1, layouts were a special kind of component that automagically wrapped generated page components. They were stored in <code class=\"language-text\">src/layouts/</code>, and received a prop called <code class=\"language-text\">children</code> that needed to be executed as a function.</p>\n<h3>How it works in Gatsby V1</h3>\n<p>A simple layout would live at <code class=\"language-text\">src/layouts/index.js</code> and might contain the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Layout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>app-wrapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Our app also might have a home page at <code class=\"language-text\">src/pages/index.js</code> that looks like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">I’m in a layout?</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Once we start the app, we’ll see the following in the browser console:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/8c5c23358a9e14a7f92a963c7c33f4df/4a00e/simple-layout.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.62162162162163%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAACDElEQVQoz42SXW+bMBSG+ee73N1+x6RdblqnTluVbo02JS1ttop8AAZszLcBY2NMINkhVbVVWqe9soyF9Z5zeB+M3LW3u+8u9XGAHdtBLspOiuPYdV3f94MgwBjTMCRhiAkcg5CG6/UaIWRghCj1CQ0JIZvNBiGXc661btu2KIqyLKEQOK7NW2dj+cizceK5nuNAZdeIk6Tv951SHUgpsCmlxpMOJ8Gh013NuWol3LW6V60CS57nhmVZpmmuVis4LBaL5XJp2/bxn4KKsFdVZcBswzCox54PbZ8zwPOJmTH2x91/6beZUgrZ1Lypai5EI5qThIDYhBB1XT++EFJK2B+mg3wAhwEgoHkYpQinWcGznEFJVlZFAYca9jwvoC6lEbABHAAFEEBRMBosS1qSSRroUrS13Mv2r6NCWzDoroMxOa+hOSA0ZiY5v0pm39D7S+/sC7pYkstbZrryxhFXFv9qNZ9/8I93zU/ElJKq05N6IHVC5eCcsGGzY24kvVjYpMKxjKt9xHpSTAvnHS72Hknj3TZE3nZnT/9aGAJRo+alSrhKq+PYF3yQ3Xjs+0Hq49P4IaG2EV2rpJywQutpbEhrX/fjMLEdD8fDM3Cmz052yfVrvXsr79/o6A7gQNpBzlgUJymEXeSwaBTN7/MPy+z8Jgsz0WsISSo9Zvb807sXF7NXi/nL1DorWP0LGNUN9cHChX4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screenshot of the generated markup with the layout wrapper around the page content.\"\n        title=\"Screenshot of the generated markup with the layout wrapper around the page content.\"\n        src=\"/gatsby-bloga-2/static/8c5c23358a9e14a7f92a963c7c33f4df/fcda8/simple-layout.png\"\n        srcset=\"/gatsby-bloga-2/static/8c5c23358a9e14a7f92a963c7c33f4df/12f09/simple-layout.png 148w,\n/gatsby-bloga-2/static/8c5c23358a9e14a7f92a963c7c33f4df/e4a3f/simple-layout.png 295w,\n/gatsby-bloga-2/static/8c5c23358a9e14a7f92a963c7c33f4df/fcda8/simple-layout.png 590w,\n/gatsby-bloga-2/static/8c5c23358a9e14a7f92a963c7c33f4df/efc66/simple-layout.png 885w,\n/gatsby-bloga-2/static/8c5c23358a9e14a7f92a963c7c33f4df/c83ae/simple-layout.png 1180w,\n/gatsby-bloga-2/static/8c5c23358a9e14a7f92a963c7c33f4df/4a00e/simple-layout.png 1406w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Like magic, our page is wrapped with the <code class=\"language-text\">.app-wrapper</code> container.</p>\n<p>If you’d like to try out this app, check out the <a href=\"https://github.com/jlengstorf/life-after-layouts/tree/v1-layout\"><code class=\"language-text\">v1-layout</code> branch of the demo repo</a>.</p>\n<h3>How it works in Gatsby V2</h3>\n<p>In V2, layouts are no longer automatically applied to our pages (more on <em>why</em> this decision was made in the next section).</p>\n<p>This ultimately boils down to two breaking changes and one recommendation:</p>\n<ol>\n<li><strong>BREAKING CHANGE:</strong> Components at <code class=\"language-text\">src/layouts/</code> are no longer automagically wrapped around page components.</li>\n<li><strong>BREAKING CHANGE:</strong> The <code class=\"language-text\">children</code> prop in our layout components is no longer a function (unless you explicitly provide a function).</li>\n<li>We now recommend moving your layout components alongside the rest of your components (e.g. into <code class=\"language-text\">src/components/</code>).</li>\n</ol>\n<p>If we upgrade our simplified app by running <code class=\"language-text\">yarn add gatsby react react-dom</code> (see <a href=\"/gatsby-bloga-2/docs/migrating-from-v1-to-v2/\">the V1 => V2 migration guide</a> for more information on why we need to install React here), we need to upgrade our layout by moving <code class=\"language-text\">src/layouts/index.js</code> to <code class=\"language-text\">src/components/layout.js</code> and changing <code class=\"language-text\">children</code> from a function to a regular prop:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Layout</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>app-wrapper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Next, in <code class=\"language-text\">src/pages/index.js</code> we need to explicitly include the <code class=\"language-text\">Layout</code> component and wrap our page in it:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> Layout <span class=\"token keyword\">from</span> <span class=\"token string\">\"../components/layout\"</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">I’m in a layout!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Layout</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Once we’ve made these changes, we can run <code class=\"language-text\">yarn develop</code> and see the updated layout in our browser:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/c44f367eb49ce83ef493cebd5743ce4f/2cefc/simple-layout-v2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.37837837837837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAACVklEQVQoz5VT226bQBDlx/tSqc/9mkrtQ9OorawothPHIQbMzSzmDku4LOxyMT3YtaqqfWiPRuwZ2Jk9OzNIqWUaxr3pH7yjZ9v24XBI0hlxHDuOA9c9w/d9z/PcI+CC4L2iKBKxTNc1HI9gB3xdN/I855w3TYMUSTKnQoT88qIqO+9g6U5AHKLrJiDFSXI6TUM/dF2HmGGYSd/3IKczxnFs25bmMziryqZrmhbGGJN2u91yudxsNsi0WCzANU2b/gE4Q4IqJK6qCk/kfn19FUL8ufWiYl5mfg1GwOXb9J+Yg6MowoLy1DUOx8oY7Iyzw+q6vhAoutRCNA04xEroRxLHrheYThjFeRSnNKfZGZcFPYO68AxwFBjVp5TClWgcN35W+UeWlpy1om7+KrLvuzAMkAXp0iwrigJcko1AllNNJVsl2Cqh7aYqYXbYWiE3r2YEwolY07YQjc79uvO3bfBdqW+X8c0m+S5nCzn7+kQXGruVqy9Xu3muF7ssJA4NfMex/aMbhaFLXKmsir5oeECnCZIHLvpp7CfRTb+Xfxg7GoVFkoZpnhVVxVroR59p4ZWCCQgqm5Hx0zBMp+GntvEEOls/jEPXUms1+JvBexSBzNsarYpxEy5EN7cBvei4aH3KVa/Vjm1e9xgC3HPACFfp44c395/f7u7ekbv3vMwkQgjKjyf+GD8I/CBMk3i9zz6us0/r1A6qsRcYPo70rPLcp60l78hzEillTiVd1zHeDw8Pq9VqvV5jyBVFPVh7z9GPjm4Ze1XVrtibpkNsslcN0yRwfwD72nmDB9La+wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screenshot of the updated layout in the browser.\"\n        title=\"Screenshot of the updated layout in the browser.\"\n        src=\"/gatsby-bloga-2/static/c44f367eb49ce83ef493cebd5743ce4f/fcda8/simple-layout-v2.png\"\n        srcset=\"/gatsby-bloga-2/static/c44f367eb49ce83ef493cebd5743ce4f/12f09/simple-layout-v2.png 148w,\n/gatsby-bloga-2/static/c44f367eb49ce83ef493cebd5743ce4f/e4a3f/simple-layout-v2.png 295w,\n/gatsby-bloga-2/static/c44f367eb49ce83ef493cebd5743ce4f/fcda8/simple-layout-v2.png 590w,\n/gatsby-bloga-2/static/c44f367eb49ce83ef493cebd5743ce4f/efc66/simple-layout-v2.png 885w,\n/gatsby-bloga-2/static/c44f367eb49ce83ef493cebd5743ce4f/c83ae/simple-layout-v2.png 1180w,\n/gatsby-bloga-2/static/c44f367eb49ce83ef493cebd5743ce4f/2cefc/simple-layout-v2.png 1400w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Check out the <a href=\"https://github.com/jlengstorf/life-after-layouts\"><code class=\"language-text\">v2-layout</code> branch of the demo repo</a> to see this in action, or see <a href=\"https://github.com/jlengstorf/life-after-layouts/compare/v1-layout...v2-layout\">the diff</a> for details on exactly what changed.</p>\n<h2>Why change the layouts?</h2>\n<p>Looking at the difference in code, it might be tempting to think, “Doesn’t that just create <em>more work</em> for developers who want to use layouts?”</p>\n<p>In short, the decision to remove layouts was part of an effort to reduce unnecessary complexity and mystery issues in Gatsby projects.</p>\n<h3>What was the unnecessary complexity?</h3>\n<p>Because layouts in V1 were applied under the hood, it made it <em>really hard</em> to pass data between the layout and the pages it wrapped.</p>\n<p>In short, layouts in V1 broke React’s compositional model, and that made things unnecessarily hard to implement. By going back to the standard React way of importing components and using them directly, we’re able to easily pass data between the layout and pages without any confusing, complicated, or otherwise unwieldy workarounds.</p>\n<h3>What are mystery issues?</h3>\n<p>In V1, if something breaks on your page, you’d likely go to the page, look through the code, and try to spot the bug. But what if the bug is in the magic layout component? That component isn’t referenced anywhere on the page, and if you don’t <em>already know</em> that Gatsby V1 wraps pages with layouts, it’s pretty difficult to figure out what’s going on.</p>\n<p>Because Gatsby is doing things in the background, out of sight of the developers building the site, we’re creating a mystery: where the hell did this bug come from if all the code I can see doesn’t have the bug?</p>\n<p>By removing the magic and making layouts an explicit dependency in V2, that same bug would be much easier to spot because there’s a clear link between our page code and the layout.</p>\n<h3>Why is this better?</h3>\n<p>Our goal at Gatsby is to make building great apps more fun and less frustrating — and <em>very few things</em> are more frustrating than mystery bugs.</p>\n<p>This change reduces the number of mysteries in your Gatsby projects, and makes debugging a little simpler.</p>\n<h2>What else is changing?</h2>\n<p>Removing layouts isn’t the only improvement coming in Gatsby V2. We’re really excited to introduce a lot of new and exciting features, such as:</p>\n<ul>\n<li>Much faster hot reloading, which enables Ludicrous Mode</li>\n</ul>\n<p><a href=\"https://twitter.com/gatsbyjs/status/974507205121617920\">https://twitter.com/gatsbyjs/status/974507205121617920</a></p>\n<ul>\n<li>We can now add GraphQL queries to any component in our app (not just page components) using <a href=\"/gatsby-bloga-2/docs/static-query/\"><code class=\"language-text\">StaticQuery</code></a></li>\n<li>Upgraded to the latest versions of React, Babel, webpack, and other libraries Gatsby depends on</li>\n<li>Better support for CSS inlining and splitting, which will boost performance</li>\n</ul>\n<p>For a full list of what’s new, check out our <a href=\"/gatsby-bloga-2/docs/migrating-from-v1-to-v2/\">V2 migration guide</a> and <a href=\"/gatsby-bloga-2/blog/2018-06-16-announcing-gatsby-v2-beta-launch/\"><em>What’s New in Gatsby V2?</em></a>.</p>\n<h2>What’s next?</h2>\n<ul>\n<li>\n<p>You can get started using Gatsby V2 right now by installing our V2 default starter:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gatsby new my-gatsby-v2-site https://github.com/gatsbyjs/gatsby-starter-default</code></pre></div>\n<p>Huge thanks to <a href=\"https://github.com/mottox2\">Yuki Takemoto</a> for upgrading the starter to V2!</p>\n</li>\n<li>You can also <a href=\"https://github.com/gatsbyjs/gatsby/projects/2\">see the V2 roadmap</a>, help us squash any V2 bugs by opening <a href=\"https://github.com/gatsbyjs/gatsby/issues\">issues</a> or sending <a href=\"https://github.com/gatsbyjs/gatsby/pulls\">pull requests</a>, or <a href=\"https://twitter.com/gatsbyjs\">follow along with our progress on Twitter</a>.</li>\n</ul>\n<p>We can’t wait to see what you build with this new and improved version of Gatsby!</p>","frontmatter":{"title":"Life After Layouts","date":"June 19, 2018","description":null}}},"pageContext":{"slug":"/docs/blog/2018-06-08-life-after-layouts/","previous":{"fields":{"slug":"/docs/blog/2018-06-18-moving-from-create-react-app-to-gatsby-js/"},"frontmatter":{"title":"Moving from create-react-app to Gatsby.js"}},"next":{"fields":{"slug":"/docs/blog/2018-06-14-escalade-sports-from-5000-to-5-in-hosting/"},"frontmatter":{"title":"Escalade Sports: From $5000 to $5/month in Hosting With Gatsby"}}}}}