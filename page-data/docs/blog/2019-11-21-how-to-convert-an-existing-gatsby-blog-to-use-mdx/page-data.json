{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2019-11-21-how-to-convert-an-existing-gatsby-blog-to-use-mdx/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"3ae4ecb1-85a0-5a63-a2a5-4b346cceaa27","excerpt":"What is MDX? MDX is a file format that lets you add JSX to Markdown files via a  file! It was started by and is maintained by Gatsby’s John Otander and the open…","html":"<h2>What is MDX?</h2>\n<p>MDX is a file format that lets you add JSX to Markdown files via a <code class=\"language-text\">.mdx</code> file! It was started by and is maintained by Gatsby’s <a href=\"https://github.com/johno\">John Otander</a> and the <a href=\"https://github.com/mdx-js/mdx\">open source community on GitHub</a>.</p>\n<p>With MDX, you can import React components and declare them alongside regular markdown syntax with JSX. This is useful to display specific component examples alongside the actual code, complex interactive components like charts, reusable components across multiple pages like sign-up forms, and more!</p>\n<h2>Adding MDX to Gatsby Starter Blog</h2>\n<p>It can be a big tricky to add MDX to an existing blog. The following 5 steps will cover how to install and configure MDX to work with <a href=\"https://github.com/gatsbyjs/gatsby-starter-blog/tree/master\">Gatsby’s blog starter</a>, which as of <a href=\"https://github.com/gatsbyjs/gatsby-starter-blog/tree/8852c1e51651b902f19706ff2ca9f60dabc25709\">today’s version</a>, does not have MDX pre-installed.</p>\n<p>You can also see the <a href=\"https://github.com/gatsbyjs/gatsby/pull/19580/files\">full changes in PR #19580</a> for an overview of the changes you have to make to get MDX working. As stated above, this introduces changes to <a href=\"https://github.com/gatsbyjs/gatsby-starter-blog/tree/master\">Gatsby’s blog starter</a>, which you can install with Gatsby CLI.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">gatsby new my-blog-starter https://github.com/gatsbyjs/gatsby-starter-blog</code></pre></div>\n<h3>Step 1</h3>\n<p>Install <a href=\"/gatsby-bloga-2/packages/gatsby-plugin-mdx/\">gatsby-plugin-mdx</a>, the official plugin for using MDX with Gatsby. Also install <code class=\"language-text\">gatsby-plugin-feed-mdx</code> for our RSS feeds. Finally, install <code class=\"language-text\">@mdx-js/mdx</code> and <code class=\"language-text\">@mdx-js/react</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save gatsby-plugin-mdx gatsby-plugin-feed-mdx @mdx-js/mdx @mdx-js/react</code></pre></div>\n<h3>Step 2</h3>\n<p>In <code class=\"language-text\">gatsby-config.js</code>, replace <code class=\"language-text\">gatsby-transformer-remark</code> with <code class=\"language-text\">gatsby-plugin-mdx</code>, along with the following changes:</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=gatsby-config.js\"><pre class=\"language-diff:title=gatsby-config.js\"><code class=\"language-diff:title=gatsby-config.js\">  {\n-  resolve: `gatsby-transformer-remark`,\n+  resolve: `gatsby-plugin-mdx`,\n   options: {\n+    extensions: [`.mdx`, `.md`],\n-    plugins: [\n+    gatsbyRemarkPlugins: [\n       {\n         resolve: `gatsby-remark-images`,\n         options: {\n           maxWidth: 590,\n         },\n       },\n       {\n         resolve: `gatsby-remark-responsive-iframe`,\n         options: {\n           wrapperStyle: `margin-bottom: 1.0725rem`,\n         },\n       },\n       `gatsby-remark-prismjs`,\n       `gatsby-remark-copy-linked-files`,\n       `gatsby-remark-smartypants`,\n     ],\n   },\n  },</code></pre></div>\n<p>For reference, here’s the full configuration for <code class=\"language-text\">gatsby-plugin-mdx</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js:title=gatsby-config.js\"><pre class=\"language-js:title=gatsby-config.js\"><code class=\"language-js:title=gatsby-config.js\">{\n  resolve: `gatsby-plugin-mdx`,\n  options: {\n    extensions: [&quot;.mdx&quot;, &quot;.md&quot;],\n    gatsbyRemarkPlugins: [\n      {\n        resolve: `gatsby-remark-images`,\n        options: {\n          maxWidth: 590,\n        },\n      },\n      {\n        resolve: `gatsby-remark-responsive-iframe`,\n        options: {\n          wrapperStyle: `margin-bottom: 1.0725rem`,\n        },\n      },\n      `gatsby-remark-prismjs`,\n      `gatsby-remark-copy-linked-files`,\n      `gatsby-remark-smartypants`,\n    ],\n  },\n},</code></pre></div>\n<p>Then, replace <code class=\"language-text\">gatsby-plugin-feed</code> with <code class=\"language-text\">gatsby-plugin-feed-mdx</code>. This will allow the RSS feed of the site to parse MDX.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=gatsby-config.js\"><pre class=\"language-diff:title=gatsby-config.js\"><code class=\"language-diff:title=gatsby-config.js\">- `gatsby-plugin-feed`,\n+ `gatsby-plugin-feed-mdx`</code></pre></div>\n<p>Now, since we’re no longer using <code class=\"language-text\">gatsby-transformer-remark</code> and <code class=\"language-text\">gatsby-plugin-feed</code>, you can uninstall them.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">npm</span> uninstall --save gatsby-transformer-remark gatsby-plugin-feed</code></pre></div>\n<h3>Step 3</h3>\n<p>In <code class=\"language-text\">gatsby-node.js</code>, replace <code class=\"language-text\">allMarkdownRemark</code> with <code class=\"language-text\">allMdx</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=gatsby-node.js\"><pre class=\"language-diff:title=gatsby-node.js\"><code class=\"language-diff:title=gatsby-node.js\"># line 11\n- allMarkdownRemark(\n+ allMdx(</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=gatsby-node.js\"><pre class=\"language-diff:title=gatsby-node.js\"><code class=\"language-diff:title=gatsby-node.js\"># line 35\n- const posts = result.data.allMarkdownRemark.edges\n+ const posts = result.data.allMdx.edges</code></pre></div>\n<p>Next, replace <code class=\"language-text\">MarkdownRemark</code> with <code class=\"language-text\">Mdx</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=gatsby-node.js\"><pre class=\"language-diff:title=gatsby-node.js\"><code class=\"language-diff:title=gatsby-node.js\"># line 56\n- if (node.internal.type === `MarkdownRemark`) {\n+ if (node.internal.type === `Mdx`) {</code></pre></div>\n<h3>Step 4</h3>\n<p>In <code class=\"language-text\">src/pages/index.js</code>, replace <code class=\"language-text\">allMarkdownRemark</code> with <code class=\"language-text\">allMdx</code> in the <code class=\"language-text\">render()</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=src/pages/index.js\"><pre class=\"language-diff:title=src/pages/index.js\"><code class=\"language-diff:title=src/pages/index.js\"># line 13\n- const posts = data.allMarkdownRemark.edges\n+ const posts = data.allMdx.edges</code></pre></div>\n<p>Also replace <code class=\"language-text\">allMarkdownRemark</code> with <code class=\"language-text\">allMdx</code> in the GraphQL query.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=src/pages/index.js\"><pre class=\"language-diff:title=src/pages/index.js\"><code class=\"language-diff:title=src/pages/index.js\"># line 59\n- allMarkdownRemark(sort: { fields: [frontmatter___date], order: DESC }) {\n+ allMdx(sort: { fields: [frontmatter___date], order: DESC }) {</code></pre></div>\n<h3>Step 5</h3>\n<p>In <code class=\"language-text\">src/templates/blog-post.js</code>, replace <code class=\"language-text\">markdownRemark</code> with <code class=\"language-text\">mdx</code> in the <code class=\"language-text\">render()</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=src/templates/blog-post.js\"><pre class=\"language-diff:title=src/templates/blog-post.js\"><code class=\"language-diff:title=src/templates/blog-post.js\"># line 11\n- const post = this.props.data.markdownRemark\n+ const post = this.props.data.mdx</code></pre></div>\n<p>Also replace <code class=\"language-text\">markdownRemark</code> with <code class=\"language-text\">mdx</code> in the GraphQL query.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=src/templates/blog-post.js\"><pre class=\"language-diff:title=src/templates/blog-post.js\"><code class=\"language-diff:title=src/templates/blog-post.js\"># line 93\n- markdownRemark(fields: { slug: { eq: $slug } }) {\n+ mdx(fields: { slug: { eq: $slug } }) {</code></pre></div>\n<p>Add an import statement for <code class=\"language-text\">MDXRenderer</code> from <code class=\"language-text\">gatsby-plugin-mdx</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=src/templates/blog-post.js\"><pre class=\"language-diff:title=src/templates/blog-post.js\"><code class=\"language-diff:title=src/templates/blog-post.js\"># line 3\n+ import { MDXRenderer } from &quot;gatsby-plugin-mdx&quot;</code></pre></div>\n<p>We’ll be using <code class=\"language-text\">body</code> instead of <code class=\"language-text\">html</code> in our GraphQL query.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=src/templates/blog-post.js\"><pre class=\"language-diff:title=src/templates/blog-post.js\"><code class=\"language-diff:title=src/templates/blog-post.js\"># line 96\n- html\n+ body</code></pre></div>\n<p>Now we can replace the <code class=\"language-text\">&lt;section&gt;</code> element with the <code class=\"language-text\">dangerouslySetInnerHTML</code> attribute and instead use <code class=\"language-text\">&lt;MDXRenderer&gt;</code> with <code class=\"language-text\">post.body</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff:title=src/templates/blog-post.js\"><pre class=\"language-diff:title=src/templates/blog-post.js\"><code class=\"language-diff:title=src/templates/blog-post.js\"># line 41\n- &lt;section dangerouslySetInnerHTML={{ __html: post.html }} /&gt;\n+ &lt;MDXRenderer&gt;{post.body}&lt;/MDXRenderer&gt;</code></pre></div>\n<p>And… that’s it! After these changes, a Gatsby blog should be able to use MDX files to render JSX alongside markdown. To test that everything works, add a <code class=\"language-text\">.mdx</code> file to <code class=\"language-text\">[your-blog]/content/blog/</code> and write some JSX. Then, run <code class=\"language-text\">gatsby develop</code> and check <code class=\"language-text\">http://localhost:8000/blog/</code> for your new post. The JSX should rendered as an element on the new post page.</p>\n<p>For example, the following code should render a test button. Navigate to <code class=\"language-text\">http://localhost:8000/blog/example/</code> and you should see a clickable button in your blog post!</p>\n<div class=\"gatsby-highlight\" data-language=\"mdx:title=content/blog/example.mdx\"><pre class=\"language-mdx:title=content/blog/example.mdx\"><code class=\"language-mdx:title=content/blog/example.mdx\">---\ntitle: MDX!\ndate: &quot;2019-10-22&quot;\ndescription: &quot;A post showing MDX in action&quot;\n---\n\nThis is a post showing MDX in action. This starter now comes with MDX out-of-the-box!\n\n```js\n// you can write JSX in your Markdown!\n&lt;button&gt;test&lt;/button&gt;\n```\n\n&lt;button&gt;test&lt;/button&gt;\n\n## MDX\n\nMDX lets you write JSX embedded inside markdown, perfect for technical blogs. MDX works with Gatsby through [gatsby-plugin-mdx](https://www.gatsbyjs.org/packages/gatsby-plugin-mdx/). You can learn more about it in the Gatsby docs: [Getting Started with MDX](https://www.gatsbyjs.org/docs/mdx/getting-started/).</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/3c9f13990b5820a5557f33f16bf32b9f/6b95e/screenshot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.05405405405406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB90lEQVQ4y61TTY/SUBTtwmjYEQZwRCMmRojGTGY0+Bf4O/wDfgmsnAWZsocVC0I0MSEmEiERprSlpSh0WmO/KOXY+0wLRqNEecnJve+jt/ec8x4nSRK63S46nQ4opxEEAbbbLcsp/i3fH1yv10O9XketVsNgMGCLm80m/uBQRD/hqBvC/46oKLdarSDLMoOiKIy2KIosJ8zncxZnsxk0TYOqqvHedDpla57n7Tq0LAumacIwjKN0yfX7fVxevgbPX+EqBM/z4Jv8Lkb5b9BsNtFoNNBut2PZuEqlglt3biP38D5Oc1lkc3eRuZdFOnuCzGk6nKdxkkkhmUz+glQqhUQigVKpFNPmqtUqHjx6jPOXr3BxcY5nZy/w9PkZCoUnIQp/RLFYRD6fR7lcxnq9/lGQRB8NP0IKjSCRRUKYkzmHgM6SMT+5fAxDYlP2J9Gd/BfEHQ6HQ7RaLVCnR7nYdAcXiwVs22bCkluet4bjuvAieC5cx8Ym3vf2znrwfX9HmYrRKyFzKJLIshgaI0wgCAIEWYWkzPFJkDBVNAihaWQGnaU4Ho/Z64kLkkOj0YiB6I8nE3y4VjEQVLy7/oK3ios3soX3mgvZ9HFjfoUeyrNcLplMFHVd31Gm1omu7TigZ0hUDXeLz1aAGyeA4fjQbR/fPP8gHb8DN/tq8VoP4r0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"example post MDX\"\n        title=\"example post MDX\"\n        src=\"/gatsby-bloga-2/static/3c9f13990b5820a5557f33f16bf32b9f/fcda8/screenshot.png\"\n        srcset=\"/gatsby-bloga-2/static/3c9f13990b5820a5557f33f16bf32b9f/12f09/screenshot.png 148w,\n/gatsby-bloga-2/static/3c9f13990b5820a5557f33f16bf32b9f/e4a3f/screenshot.png 295w,\n/gatsby-bloga-2/static/3c9f13990b5820a5557f33f16bf32b9f/fcda8/screenshot.png 590w,\n/gatsby-bloga-2/static/3c9f13990b5820a5557f33f16bf32b9f/efc66/screenshot.png 885w,\n/gatsby-bloga-2/static/3c9f13990b5820a5557f33f16bf32b9f/c83ae/screenshot.png 1180w,\n/gatsby-bloga-2/static/3c9f13990b5820a5557f33f16bf32b9f/6b95e/screenshot.png 1458w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>If you’re interested in spinning up a new personal blog with MDX, I’ve prepared <a href=\"https://github.com/thomaswangio/gatsby-personal-starter-blog\">Gatsby personal blog starter</a> for your usage!</p>\n<h2>Further Reading</h2>\n<ol>\n<li><a href=\"/gatsby-bloga-2/docs/mdx/\">Gatsby Reference Guide on MDX</a></li>\n<li><a href=\"https://mdxjs.com/getting-started/gatsby\">MDX Gatsby Documentation</a></li>\n</ol>","frontmatter":{"title":"How to convert an existing Gatsby blog to use MDX","date":"November 21, 2019","description":null}}},"pageContext":{"slug":"/docs/blog/2019-11-21-how-to-convert-an-existing-gatsby-blog-to-use-mdx/","previous":{"fields":{"slug":"/docs/blog/2019-11-20-gazette-october/"},"frontmatter":{"title":"Gatsby Gazette: The \"What happened to October?\" Edition"}},"next":{"fields":{"slug":"/docs/blog/2019-11-25-introducing-gatsby-preview-for-cosmic-js/"},"frontmatter":{"title":"Introducing Gatsby Preview for Cosmic"}}}}}