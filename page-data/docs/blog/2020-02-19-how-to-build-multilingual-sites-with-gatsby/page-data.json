{"componentChunkName":"component---src-templates-blog-post-js","path":"/docs/blog/2020-02-19-how-to-build-multilingual-sites-with-gatsby/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"666e1cda-1721-55e8-939f-74f50a75097d","excerpt":"Multilingual websites are never easy. Soon after you start adding languages, you discover things like language fallbacks, ISO codes, language-sensitive…","html":"<p>Multilingual websites are never easy. Soon after you start adding languages, you discover things like language fallbacks, ISO codes, language-sensitive restrictions for editors - you encounter all these obstacles before you even implement a thing. What should you know upfront to avoid running into a trap?</p>\n<p>In this article, I will shed some light on the essential topics around multilingual sites, present some of the key questions you should ask before you start implementing multilingual support, and touch a bit on the Gatsby implementation as well.</p>\n<p>The first part of the article will be CMS agnostic. For the basics, it doesn’t matter whether you use Contentful, Kontent, Prismic, or any other CMS. It’s more about the expectations of your customers. In the second part, I will talk about Kontent source plugin specifics and how to handle language fallbacks.</p>\n<h2>ISO Codes or Codenames</h2>\n<p>When you work with multiple languages, each content piece needs to be flagged with a language. Languages like English and German make this straightforward, you can use their ISO codes as flags. But sometimes you need to distinguish between countries that speak the same language, such as Portugal and Brazil. We also have ISO codes for countries, and together with their language they form a language code (<code class=\"language-text\">en-US</code>, <code class=\"language-text\">cs-CZ</code>, and so on). Many CMSs use that to identify content for that specific part of the world. It’s important to be able to extend this list, though.</p>\n<p>Why?</p>\n<p>Let me tell you a story about a Zoo in Brno, my hometown. It’s not a particularly special one. It’s normal in size, there is not really anything that would attract visitors from long distances. So they try to get creative with marketing. You can always find signs near enclosures presenting the displayed animal including some facts about its life. They translated those signs into a local dialect and even though no one really speaks that dialect anymore, a lot of people understand it and consider it funny.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/d5d79e6f5cca2d271acf54bea1004f0c/00597/zoo-sign.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECBQP/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB2JZ0azgq1iLiv//EABoQAAICAwAAAAAAAAAAAAAAAAABAgMREkH/2gAIAQEAAQUCYhLB227WdE1OvukW0sH/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAdEAEAAQMFAAAAAAAAAAAAAAABAAIQESExMnGR/9oACAEBAAY/At2cm6FQdkyWzg8mk//EABwQAQADAAIDAAAAAAAAAAAAAAEAESExcVFhsf/aAAgBAQABPyG9v0htrWUKte48z3Mc1R2gKSajeGfNIAoB1P/aAAwDAQACAAMAAAAQlMj8/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EMIz/8QAFxEBAAMAAAAAAAAAAAAAAAAAAREgIf/aAAgBAgEBPxCA2n//xAAcEAEAAgMBAQEAAAAAAAAAAAABABEhMVGxQYH/2gAIAQEAAT8QYuAXQq8ggh5trH5Oy927ZmxoYcIhKJemdRCRLpTpuG53cYLv0j5KIDgqf//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Zoo sign\"\n        title=\"Zoo sign\"\n        src=\"/gatsby-bloga-2/static/d5d79e6f5cca2d271acf54bea1004f0c/1c72d/zoo-sign.jpg\"\n        srcset=\"/gatsby-bloga-2/static/d5d79e6f5cca2d271acf54bea1004f0c/a80bd/zoo-sign.jpg 148w,\n/gatsby-bloga-2/static/d5d79e6f5cca2d271acf54bea1004f0c/1c91a/zoo-sign.jpg 295w,\n/gatsby-bloga-2/static/d5d79e6f5cca2d271acf54bea1004f0c/1c72d/zoo-sign.jpg 590w,\n/gatsby-bloga-2/static/d5d79e6f5cca2d271acf54bea1004f0c/00597/zoo-sign.jpg 678w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This led to a very positive reaction from their visitors. Of course, I don’t know if that caused better conversions regarding ticket sales, but I’m trying to focus on the lingual part here. There is no language code for the local dialect they used. So if they decided to put the translations online, they’d have to store them under <em>something</em>. A codename.</p>\n<h2>Language Fallbacks</h2>\n<p>Let’s say you implemented a website with one language for a friend, we’ll call him Matt. After some time, he comes back to you saying he’d like to add a Czech translation as he receives some traffic from central Europe. OK, no problem, we add a new language, Matt handles content translations and the job is done.</p>\n<p>It takes one week for him to find out that keeping content in both languages is quite a time-demanding task. So he decides that if he adds some content in English only, it should be also displayed on the Czech site as it’s better to have the untranslated content there than a blank page. So far, so good.</p>\n<p>In another half a year, he wants to add Slovak. And you start getting the feeling this will never stop and you should not have agreed to build his website in exchange for three beers. The thing is, Slovak is very similar to Czech and therefore it’s likely that more people from Slovakia will understand Czech rather than English. That’s why Slovak will fallback to Czech and Czech will fallback to English.</p>\n<p>This is still configurable in a headless CMS. But you need to think about how your website will render such content. Most content items contain links to other content or include it directly. Do you want to let your visitors know that linked content is available in a different language only, mix the content, or not display it at all?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 538px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/c16680fedb49f16cc9b03b16e76b3199/9516f/link-with-desc.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.513513513513512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAfklEQVQI103OyxLCIAwFUP7//2rtRAo0PFoF10AKSHGc8SxubrIKI6JSClHucU1Ko5805CGlRCPzT4yxJwMAvgopDQAivgTX91nI7dAaNaIxZndOKeWstW7HDfsagu8XH95M43Y8/SoKAE3TyR9lvtGyXO90tdbWWh2+pf35AKguqUnJuK+zAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Linked content is only available in a different language\"\n        title=\"Linked content is only available in a different language\"\n        src=\"/gatsby-bloga-2/static/c16680fedb49f16cc9b03b16e76b3199/9516f/link-with-desc.png\"\n        srcset=\"/gatsby-bloga-2/static/c16680fedb49f16cc9b03b16e76b3199/12f09/link-with-desc.png 148w,\n/gatsby-bloga-2/static/c16680fedb49f16cc9b03b16e76b3199/e4a3f/link-with-desc.png 295w,\n/gatsby-bloga-2/static/c16680fedb49f16cc9b03b16e76b3199/9516f/link-with-desc.png 538w\"\n        sizes=\"(max-width: 538px) 100vw, 538px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And what if the linked content is available only in a language different from the default one (in this case, English)? A typical example of this is a blog post and its author. When the blog post is in English and the author’s bio only in Czech, what will you display?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/645ac281279266b6e9b51e463e3bdc22/e85cb/required-field.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAe0lEQVQI132N0Q7DIAhF/f+f3MPaKaNWFGzcrHO0iXvrzsMJueGCEZHFr1sKMt/Qh5TSa1BKUfcLWmuGha21DwuzAwegZUS0zsET79OEuPT+uSy/B/pEXWv9zQf73kQaAhMxc6QYAtHpnDejkfwhZ46R/XqsR6JAYaA3vtoH5cfeqzfAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Author field is required\"\n        title=\"Author field is required\"\n        src=\"/gatsby-bloga-2/static/645ac281279266b6e9b51e463e3bdc22/e85cb/required-field.png\"\n        srcset=\"/gatsby-bloga-2/static/645ac281279266b6e9b51e463e3bdc22/12f09/required-field.png 148w,\n/gatsby-bloga-2/static/645ac281279266b6e9b51e463e3bdc22/e4a3f/required-field.png 295w,\n/gatsby-bloga-2/static/645ac281279266b6e9b51e463e3bdc22/e85cb/required-field.png 480w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You see, fallbacks are not just about content and its presentation online. It’s also about content creation and applied restrictions. Some fields need to be filled, some fields require editors to link an item or two. You need to define what content is allowed and what content is invalid based on the requirements of your client.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/2f6448159e9ef0aab7fb7831f4eb5c6f/00d43/rich-text.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.513513513513512%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAd0lEQVQI142OSwrCQBBEc/qcxZ2XyA3EjQay0ZlI+jOxZ0i6G9Exiyxc+aCKoqCgmvcfqPksrytwezoe+k7zkkupfVPkKZJxfOA0pZSYGQAIkZmQEACrqg83Ol9CnCktsq7q7t9xDPcYgqq6mW/Yxp73XtV+Hn0AQ/qr6nmbVoMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Linked item in free text field\"\n        title=\"Linked item in free text field\"\n        src=\"/gatsby-bloga-2/static/2f6448159e9ef0aab7fb7831f4eb5c6f/fcda8/rich-text.png\"\n        srcset=\"/gatsby-bloga-2/static/2f6448159e9ef0aab7fb7831f4eb5c6f/12f09/rich-text.png 148w,\n/gatsby-bloga-2/static/2f6448159e9ef0aab7fb7831f4eb5c6f/e4a3f/rich-text.png 295w,\n/gatsby-bloga-2/static/2f6448159e9ef0aab7fb7831f4eb5c6f/fcda8/rich-text.png 590w,\n/gatsby-bloga-2/static/2f6448159e9ef0aab7fb7831f4eb5c6f/efc66/rich-text.png 885w,\n/gatsby-bloga-2/static/2f6448159e9ef0aab7fb7831f4eb5c6f/00d43/rich-text.png 1000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Implementation</h2>\n<p>The more time you invest in gathering requirements, the less time you will need to spend on implementation. So what do we need to implement?</p>\n<ul>\n<li>Localize URLs</li>\n<li>Identify user locale</li>\n<li>Generate language-specific dynamic pages</li>\n<li>Generate language-specific static pages</li>\n<li>Update components</li>\n</ul>\n<p>To illustrate these steps, I used a sample intranet app that was built on Gatsby and Kentico Kontent and used only a single language - English. You can <a href=\"https://github.com/Simply007/kontent-sample-app-gatsby-intranet\">find it on GitHub</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/gatsby-bloga-2/static/396039fe128f5b1bda5efe7c3a48d102/2c95d/intranet.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.97297297297297%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABkUlEQVQoz42Sv07CUBTG+xIU0arUFiSlSKKJoC+gq4FSjE7GxInJJxCjC4kLiW/gIKvBTTcHQuJC4uKERiewhdL/7a2nQEgpGPvlDPd89/zy3dx7sev9rb2d7d1MlqTiOYYY8ITAr4jcknCAzy2xQAiH5OAk+c7RWIZlNlOpdDJJLEe57IZWLUm359LNWb/M9y+Lo+pdFPvl8dr1r46lyumgWsKYBJOgYzRJRvAwzxUcxzEMw7QsCzmjQs5YE8eyERTMYGmWTTPsOkVHQnghl4chhCbzrrpdsdl8az2/aqrh9p5NjIpGITZO0Yv4QiHPeeHRolar39/VjyoPjy8taG0beeDVKFSMXFvEw7PJcPx2+0NVtMZT4/vzy7f7D2zbtizLiqKYmoq8oUHgET8U8vmBYLEndjod4UcwTfNvOBTm83kgNU3Tg2kKhmSAwTWCyZfMAQwumhFcO5xo0sKMPg3jAMPNwKnnwKYJt25Pm34YLFVVnRlBMryZ9wl0TffDMOS+KgTNSJIk99sPZei6Isu/ehSQ+9tJnFAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Intranet app preview\"\n        title=\"Intranet app preview\"\n        src=\"/gatsby-bloga-2/static/396039fe128f5b1bda5efe7c3a48d102/fcda8/intranet.png\"\n        srcset=\"/gatsby-bloga-2/static/396039fe128f5b1bda5efe7c3a48d102/12f09/intranet.png 148w,\n/gatsby-bloga-2/static/396039fe128f5b1bda5efe7c3a48d102/e4a3f/intranet.png 295w,\n/gatsby-bloga-2/static/396039fe128f5b1bda5efe7c3a48d102/fcda8/intranet.png 590w,\n/gatsby-bloga-2/static/396039fe128f5b1bda5efe7c3a48d102/efc66/intranet.png 885w,\n/gatsby-bloga-2/static/396039fe128f5b1bda5efe7c3a48d102/2c95d/intranet.png 1099w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The app contains a list of employees and a profile page for every one of them.</p>\n<p>Before we jump into code, it’s essential to mention plugins. They greatly help with handling multilingual websites in Gatsby, so it would be a waste of time to try and reinvent the wheel here. For the full list, see <a href=\"/gatsby-bloga-2/docs/localization-i18n/\">Gatsby docs</a>. I chose the <a href=\"https://github.com/angeloocana/gatsby-plugin-i18n\">gatsby-plugin-i18n</a> as it is capable of automatic locale identification, handles language-specific static pages, and lets me configure the basics.</p>\n<div class=\"gatsby-highlight\" data-language=\"js:title=gatsby-config.js\"><pre class=\"language-js:title=gatsby-config.js\"><code class=\"language-js:title=gatsby-config.js\">{\n  resolve: `gatsby-plugin-i18n`,\n  options: {\n    langKeyDefault: &#39;en&#39;,\n    langKeyForNull: &#39;en&#39;,\n    prefixDefault: false,\n    useLangKeyLayout: false,\n  },\n},</code></pre></div>\n<p>This configuration (in <code class=\"language-text\">gatsby-config.js</code>) tells the plugin to use <code class=\"language-text\">&#39;en&#39;</code> as the default language code (<code class=\"language-text\">langKeyDefault</code>, <code class=\"language-text\">langKeyForNull</code>) and no prefix (<code class=\"language-text\">prefixDefault</code>). The last option (<code class=\"language-text\">useLangKeyLayout</code>) specifies that the used layout is language invariant.</p>\n<h3>Localize URLs</h3>\n<p>Right at the beginning, we need to think about URLs. Do you want the language code in the URL all the time? Should the default language be accessible without language code?</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">╔════════════════════════════════════════════════════╗\n║       All languages use language code in URL       ║\n╠════════════════════════════════════════════════════╣\n║ /en-US/home                                        ║\n║ /cs-CZ/home                                        ║\n║ /sk-SK/home                                        ║\n╚════════════════════════════════════════════════════╝\n╔════════════════════════════════════════════════════╗\n║ Default language does not use language code in URL ║\n╠════════════════════════════════════════════════════╣\n║ /home                                              ║\n║ /cs-CZ/home                                        ║\n║ /sk-SK/home                                        ║\n╚════════════════════════════════════════════════════╝\n╔════════════════════════════════════════════════════╗\n║          Only simple language code in URL          ║\n╠════════════════════════════════════════════════════╣\n║ /en/home                                           ║\n║ /cs/home                                           ║\n║ /sk/home                                           ║\n╚════════════════════════════════════════════════════╝</code></pre></div>\n<p>I chose the variant with default language having no prefix in the URL.</p>\n<h3>Identify User Locale</h3>\n<p>If your website is not Google Maps, people most likely won’t share their location with you. Therefore, when identifying where a visitor is geographically, we rely on the information browsers send in the first request. That can be obtained via <code class=\"language-text\">window.navigator.language</code>, but we typically don’t implement this part ourselves. In my case, it’s a job that is handled by the aforementioned <code class=\"language-text\">gatsby-plugin-i18n</code>.</p>\n<h3>Generate Language-specific Dynamic Pages</h3>\n<p>As I mentioned already, the intranet app contains profile pages for all employees. They are generated dynamically because, well, the list of employees is also dynamic. This code piece that sits in <code class=\"language-text\">gatsby-node.js</code>’s <code class=\"language-text\">createPages</code> generates pages in the original implementation:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">graphql</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  query peoplePortalList {\n    allKontentItemPerson() {\n      nodes {\n        elements {\n          urlslug {\n            value\n          }\n        }\n      }\n    }\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ...</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> person <span class=\"token keyword\">of</span> nodes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">employees/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>person<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">.</span>urlslug<span class=\"token punctuation\">.</span>value<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    component<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/person.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      slug<span class=\"token operator\">:</span> person<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">.</span>urlslug<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We will need to adjust both the GraphQL query and the code that generates pages.</p>\n<p>During the build time, the <a href=\"/gatsby-bloga-2/docs/sourcing-from-kentico-kontent/\">Kontent source plugin</a> generates one Gatsby node per each content item - language combination. To distinguish these nodes, they always contain two fields:</p>\n<ul>\n<li><strong>preferred_language</strong>\nThis field is mainly used for filtering and describes the language the item is intended for. For example, if you want Czech content, you want to filter for <code class=\"language-text\">preferred_language=&#39;cs&#39;</code> provided you use the codename <code class=\"language-text\">&#39;cs&#39;</code> for Czech.</li>\n<li><strong>system.language</strong>\nThis is the actual content item language. If you filter items based on <code class=\"language-text\">preferred_language=&#39;cs&#39;</code>, you will get <code class=\"language-text\">system.language=&#39;cs&#39;</code> if the item is translated. Otherwise, the item content will be in English, and <code class=\"language-text\">system.language</code> will be <code class=\"language-text\">&#39;default&#39;</code> (here, it’s English).</li>\n</ul>\n<p>In my case, I am happy with language fallbacks for items that are not translated. That means I can use <code class=\"language-text\">preferred_language</code> and treat all items as if they were translated.</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> PeoplePortalList <span class=\"token punctuation\">{</span>\n  allKontentItemPerson<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    nodes <span class=\"token punctuation\">{</span>\n      elements <span class=\"token punctuation\">{</span>\n        urlslug <span class=\"token punctuation\">{</span>\n          value\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      preferred_language\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you don’t want to display items that fallback to parent language, just compare <code class=\"language-text\">preferred_language</code> and <code class=\"language-text\">system.language</code>. If they are not the same, it’s a fallback.</p>\n<p>Let’s define here a new variable <code class=\"language-text\">lang</code> that will hold the language code for the current item’s <code class=\"language-text\">preferred_language</code>. I will use it in the <code class=\"language-text\">createPage</code> method call to place the newly generated page on the right URL.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> person <span class=\"token keyword\">of</span> nodes<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> lang <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>person<span class=\"token punctuation\">.</span>preferred_language<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>person<span class=\"token punctuation\">.</span>preferred_language <span class=\"token operator\">===</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    lang <span class=\"token operator\">=</span> <span class=\"token string\">\"/\"</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    path<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>lang<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">employees/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>person<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">.</span>urlslug<span class=\"token punctuation\">.</span>value<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    component<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">./src/templates/person.js</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      slug<span class=\"token operator\">:</span> person<span class=\"token punctuation\">.</span>elements<span class=\"token punctuation\">.</span>urlslug<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span>\n      lang<span class=\"token operator\">:</span> person<span class=\"token punctuation\">.</span>preferred_language<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Generate Language-specific Static Pages</h3>\n<p>Apart from dynamic pages, there are always some static pages. They include <code class=\"language-text\">index.js</code> and <code class=\"language-text\">employees.js</code> that handle the homepage and employees page respectively. The <code class=\"language-text\">gatsby-plugin-i18n</code> will place them on the right language-specific URLs if you follow the defined language convention-the filename suffix needs to contain the language code.</p>\n<ul>\n<li>\n<p><code class=\"language-text\">index.js</code> -></p>\n<ul>\n<li><code class=\"language-text\">index.en.js</code></li>\n<li><code class=\"language-text\">index.cs.js</code></li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">employees.js</code> -></p>\n<ul>\n<li><code class=\"language-text\">employees.en.js</code></li>\n<li><code class=\"language-text\">employees.cs.js</code></li>\n</ul>\n</li>\n</ul>\n<p>It’s also necessary to adjust the content of each of the new files to reflect its new language. That includes component properties. Take a look at this part of my index.js:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx:title=index.js\"><pre class=\"language-jsx:title=index.js\"><code class=\"language-jsx:title=index.js\">&lt;Layout location={location} title={title}&gt;\n  &lt;IndexContent /&gt;\n&lt;/Layout&gt;</code></pre></div>\n<p>Once this file becomes <code class=\"language-text\">index.cs.js</code>, I need to adjust it to:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx:title=index.cs.js\"><pre class=\"language-jsx:title=index.cs.js\"><code class=\"language-jsx:title=index.cs.js\">&lt;Layout location={location} title={title} lang=&quot;cs&quot;&gt;\n  &lt;IndexContent lang=&quot;cs&quot; /&gt;\n&lt;/Layout&gt;</code></pre></div>\n<h3>Update Components</h3>\n<p>That takes us to components and selected language propagation. Every component you use on your site that has anything to do with links or languages needs to know what is the current language. Take a language selector as an example. Sure, you can render it as a simple list of supported languages, but, usually, you want a bit better UX. The current language should be hidden, and switching to another language should not lose the context of the current page (very annoying behavior).</p>\n<p>There are multiple ways to handle the language propagation. They are ranging from storing it in site configuration and accessing it from components using GraphQL queries to wrapping all components in a language-specific wrapper or creating a special object just for this use case (for example, <code class=\"language-text\">gatsby-plugin-intl</code> plugin does it this way).</p>\n<p>I always aim to keep things simple. In my case, the language travels through components from top to bottom. The language-specific <code class=\"language-text\">index</code> page defines the language code for the <code class=\"language-text\">IndexContent</code> component. If a child component requires the current language, it will receive it from its parent the same way.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Content</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> classes<span class=\"token punctuation\">,</span> lang <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">EmployeeList</span></span> <span class=\"token attr-name\">lang</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>lang<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The last part of this multilingual adjustment tutorial is the language selector. It’s a brand new component that needs to know the current language and also the current URL path. That way, it can render links that keep the context of the current page when switching between languages.</p>\n<p>A very simple implementation featuring just two languages (Czech and English) can look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> PropTypes <span class=\"token keyword\">from</span> <span class=\"token string\">\"prop-types\"</span>\n<span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Location <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@reach/router\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"gatsby\"</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">LanguageSelector</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> classes<span class=\"token punctuation\">,</span> lang<span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">,</span> className <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>lang <span class=\"token operator\">===</span> <span class=\"token string\">\"default\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span> <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">to</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">/cs/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>location<span class=\"token punctuation\">.</span>pathname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        čeština\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Link</span></span>\n        <span class=\"token attr-name\">className</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>className<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">to</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>location<span class=\"token punctuation\">.</span>pathname<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> lang <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        english\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Link</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> LanguageSelector</code></pre></div>\n<p>If the current language is English, there is no language prefix in the URL and we can directly use <code class=\"language-text\">location.pathname</code> to render the language-specific link. In any other case, we first need to remove the language prefix from the path.</p>\n<p>In the case of catering for more than just two languages, you will probably be better off defining the list of available languages in a separate file.</p>\n<h2>Summary</h2>\n<p>You see that adding multiple languages to sites is not as simple as it seems at the start. It mainly requires you to define how the website should behave and what the content restrictions are. The implementation is made easier by many available plugins that help you do the job.</p>\n<p>Have you published a multilingual website on Gatsby? Let me know how you implemented it and what your experience was like on <a href=\"https://twitter.com/ondrabus\">Twitter</a>.</p>\n<p>You can also check out <a href=\"https://github.com/ondrabus/kontent-sample-app-gatsby-intranet/tree/multilingual\">this implementation on GitHub in a separate branch of the forked source repository</a> or the <a href=\"/gatsby-bloga-2/docs/sourcing-from-kentico-kontent/\">Kontent source plugin page</a> in the docs.</p>","frontmatter":{"title":"How to Build Multilingual Sites with Gatsby","date":"February 19, 2020","description":null}}},"pageContext":{"slug":"/docs/blog/2020-02-19-how-to-build-multilingual-sites-with-gatsby/","previous":{"fields":{"slug":"/docs/blog/100days/accessibility/"},"frontmatter":{"title":"Challenge 8 - Make Your Forms and Images Accessible to Everyone"}},"next":{"fields":{"slug":"/docs/blog/100days/seo/"},"frontmatter":{"title":"Challenge 9 - Optimize Your Website for Search Engines (SEO)"}}}}}